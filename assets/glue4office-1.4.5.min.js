!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("glue4office",[],t):"object"==typeof exports?exports.glue4office=t():e.glue4office=t()}(this,function(){return function(e){function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=37)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(47),o=n(1),i=n(3);t.attachmentsErrorMessage='Invalid type of "attachments" element, expected array of strings for existing attachments or array of "{data: string, fileName: string}" for dynamically created attachments',t.isOutlookEnabled=function(e){return e.methods({name:o.CreateItemMethodName}).length>0},t.getOlDefaultFolders=function(){return{$SentMail:5,$Inbox:6}},t.concatChunkData=function(e){var n="";return e.forEach(function(e){n+=t.encodeData(e)}),n},t.encodeData=function(e){return atob(e)},t.decodeData=function(e){return btoa(e)},t.generateConversationId=function(){return{systemName:Math.random().toString(36).substr(2,10),nativeId:(new Date).getTime().toString()}},t.convertToT42Email=function(e){var t={attachments:e.attachments||[],body:e.body,bodyHtml:e.bodyHtml,subject:e.subject},n=i.validateRecipients(e);return["to","cc","bcc"].forEach(function(e){var r=n[e];if(r){var o=[];r.forEach(function(e){o.push({emails:[e]})}),t[e]=o}n.sender&&(t.sender={emails:[n.sender]})}),t},t.convertToT42Task=function(e){return{attachments:e.attachments||[],body:e.body,dueDate:e.dueDate,importance:s(e.priority),reminderTime:e.reminderTime,startDate:e.startDate,subject:e.subject}};var s=function(e){return"number"==typeof r.TaskPriority[e]?r.TaskPriority[e]:r.TaskPriority.normal};t.getTaskPriority=function(e){return r.TaskPriority.low===e?"low":r.TaskPriority.high===e?"high":"normal"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreateItemMethodName="T42.Outlook.CreateItem",t.ShowItemMethodName="T42.Outlook.ShowItem",t.SaveItemMethodName="T42.Outlook.SaveItem",t.OnSendMethodName="T42.Outlook.OnSendMethod",t.OnCancelMethodName="T42.Outlook.OnCancelMethod",t.OnEmailReceivedMethodName="T42.Outlook.OnEmailReceived",t.OnTaskCreatedMethodName="T42.Outlook.OnTaskCreated",t.OutlookGetAttachmentMethodName="T42.Outlook.GetAttachment",t.CreateLocalEmailMethodName="T42.Outlook.CreateLocalEmail",t.OutlookGetItemAsMsgMethodName="T42.Outlook.GetItemAsMsgMethod",t.TmpFilesAppendMethodName="T42.TmpFiles.Append",t.OnTrackEmailMethodName="T42.CRM.TrackEmail",t.OnUntrackEmailMethodName="T42.CRM.UntrackEmail",t.OnTrackItemMethodName="T42.CRM.TrackCalendarItem",t.OnUntrackItemMethodName="T42.CRM.UntrackCalendarItem",t.CRMGetAttachmentMethodName="T42.CRM.GetAttachment",t.CRMGetItemAsMsgMethodName="T42.CRM.GetItemAsMsg",t.SyncTrackEmailMethodName="T42.CRM.SyncTrackEmail",t.SyncUntrackEmailMethodName="T42.CRM.SyncUntrackEmail",t.SyncTrackCalendarItemMethodName="T42.CRM.SyncTrackCalendarItem",t.SyncUntrackCalendarItemMethodName="T42.CRM.SyncUntrackCalendarItem",t.SecureReplyMethodName="T42.CRM.SecureReply",t.DisplaySecureMailMethodName="T42.CRM.DisplaySecureMail"},function(e,t,n){"use strict";function createRegistry(e){function add(e,t){var r=n[e];return r||(r=[],n[e]=r),r.push(t),function(){var r=n[e];r&&(r=r.reduce(function(e,n,r){return n===t&&e.length===r||e.push(n),e},[]),n[e]=r)}}function execute(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=n[e];if(!o||0===o.length)return[];var i=[];return o.forEach(function(n){try{var r=n.apply(undefined,t);i.push(r)}catch(t){i.push(undefined),_handleError(t,e)}}),i}function _handleError(n,r){var o=n instanceof Error?n:new Error(n);if(t)return void t(o);var i='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+o.stack;if(e)switch(e.errorHandling){case"log":return console.error(i);case"silent":return;case"throw":throw new Error(i)}console.error(i)}function clear(){n={}}if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};return{add:add,execute:execute,clear:clear}}createRegistry["default"]=createRegistry,e.exports=createRegistry},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.validateRecipients=function(e){var t=["to","cc","bcc"];return Object.keys(e).reduce(function(n,r){if(t.indexOf(r)>=0){var o=e[r];if(!Array.isArray(o))return n[r]=[o.toString()],n;n[r]=[],o.forEach(function(e){n[r].push(e.toString())})}return n[r]=e[r],n},{})},t.validateAttachments=function(e){if(!Array.isArray(e))throw new Error(r.attachmentsErrorMessage);if(0===e.length)return e;var t=!0,n=e[0];return n.data!==undefined||n.fileName!==undefined?e.forEach(function(e){"string"==typeof e.data&&"string"==typeof e.fileName||(window.console.warn(r.attachmentsErrorMessage),t=!1)}):e.forEach(function(e){"string"!=typeof e&&(window.console.warn(r.attachmentsErrorMessage),t=!1)}),t?e:null},t.validateDate=function(e,t){var n=new Date(e),r=n.getTime();return isNaN(r)?(window.console.warn('Invalid type of "'+t+'", expected "Date" or unix timestamp number'),null):e},t.validatePriority=function(e){var t=["low","normal","high"];if("string"!=typeof e)return window.console.warn('Invalid type of "priority", expected "string", one of: "low", "normal" or "high"'),"normal";if(t.indexOf(e)<0)throw new Error('Invalid type of "priority", expected "string", one of: "low", "normal" or "high"');return e},t.validateNewItemOptions=function(e){if(e.onSent&&"function"!=typeof e.onSent)throw new Error('Invalid type of "onSent" callback, expected function');if(e.onSaved&&"function"!=typeof e.onSaved)throw new Error('Invalid type of "onSaved" callback, expected function');if(e.onCanceled&&"function"!=typeof e.onCanceled)throw new Error('Invalid type of "onCanceled" callback, expected function')},t.validateLocalEmailParameters=function(e,t){if(!r.isOutlookEnabled(e))throw new Error('The method "createLocalEmail" is not available');if(!t)throw new Error('"localEmailParams" of type object are mandatory');if(!t.sender)throw new Error('The property "sender" in "localEmailParams" is mandatory');if("string"!=typeof t.sender)throw new Error('Invalid type of "sender", expected string');if(!t.to)throw new Error('The property "to" in "localEmailParams" is mandatory');if("string"!=typeof t.to&&!Array.isArray(t.to))throw new Error('Invalid type of "to", expected string or string[]');if(!t.subject)throw new Error('The property "subject" in "localEmailParams" is mandatory');if("string"!=typeof t.subject)throw new Error('Invalid type of "subject", expected string')},t.validateLocation=function(e){if("string"!=typeof e&&!e.ids)throw new Error("Invalid location");if("string"==typeof e&&0===e.indexOf("$")){if("number"!=typeof r.getOlDefaultFolders()[e])throw new Error("Invalid location")}},t.validateCalendarEventParameters=function(e,t,n){if(!r.isOutlookEnabled(e)){var o="track"===t?"trackEmail":"untrackEmail";throw new Error("The method "+o+" is not available")}if(!n||!n.ids||0===n.ids.length)throw new Error("Invalid meeting / appointment")},t.validateId=function(e){if(!e.systemName||!e.nativeId)throw new Error('Invalid type of conversationId, expected "{systemName: string, nativeId: string"');return{systemName:e.systemName.toString(),nativeId:e.nativeId.toString()}}},function(e,t,n){"use strict";function reset(){i=!1}function setCharacters(e){if(!e)return void(r!==a&&(r=a,reset()));if(e!==r){if(e.length!==a.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. These characters were not unique: "+t.join(", "));r=e,reset()}}function characters(e){return setCharacters(e),r}function setSeed(e){s.seed(e),o!==e&&(reset(),o=e)}function shuffle(){r||setCharacters(a);for(var e,t=r.split(""),n=[],o=s.nextValue();t.length>0;)o=s.nextValue(),e=Math.floor(o*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function getShuffled(){return i||(i=shuffle())}function lookup(e){return getShuffled()[e]}var r,o,i,s=n(28),a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";e.exports={characters:characters,seed:setSeed,lookup:lookup,shuffled:getShuffled}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(43),o=function(){function AttachmentImpl(e,t,n){this.cookie=e.cookie,this.emailIds=e.emailIds,this.data=e.data,this.ids=e.ids,this.name=e.name,this.sizeHint=e.sizeHint,this.errorMessage=e.errorMessage,this.more=e.more,this.success=e.success,this.agm=t,n&&(this.parent=n)}return AttachmentImpl.prototype.getData=function(e){return r.getAttachment(this.agm,this.emailIds,this.ids,e)},AttachmentImpl}();t.AttachmentImpl=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(5),i=function(){function EmailImpl(e,t){var n=this;e.attachments&&e.attachments.length>0&&(this.attachments=[],e.attachments.forEach(function(e){n.attachments.push(new o.AttachmentImpl(e,t,n))})),this.bcc=e.bcc,this.body=e.body,this.bodyHtml=e.bodyHtml,this.cc=e.cc,this.date=e.date,this.ids=e.ids,this.sender=e.sender,this.subject=e.subject,this.to=e.to,this.entityType=e.entityType}return EmailImpl.prototype.show=function(){return r["default"].showItemMethod(this.ids,"showEmail")},EmailImpl.prototype.saveToFile=function(){return r["default"].saveItemMethod(this.ids,"saveEmail")},EmailImpl.prototype.getAsMsg=function(){return r["default"].getItemAsMsg(this.ids)},EmailImpl.prototype.track=function(e){return r["default"].handleTrackingEmails("track",this.ids,e)},EmailImpl.prototype.untrack=function(){return r["default"].handleTrackingEmails("untrack",this.ids)},EmailImpl}();t.EmailImpl=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(1),i=n(3),s=n(13),a=n(14),c=function(){function Manager(){}return Manager.prototype.init=function(e){this.agm=e},Manager.prototype.showItemMethod=function(e,t){var n=this;return new Promise(function(i,s){if(!r.isOutlookEnabled(n.agm))return void s('The method "'+t+'" is not available');e=n.validateIds(e);var a=function(){i(e)},c=function(e){s(e.message)};n.agm.invoke(o.ShowItemMethodName,{itemT42Ids:e}).then(function(){return a()})["catch"](function(e){return c(e)})})},Manager.prototype.saveItemMethod=function(e,t){var n=this;return new Promise(function(i,s){if(!r.isOutlookEnabled(n.agm))return void s('The method "'+t+'" is not available');var a=function(e){i(e.returned.url)},c=function(e){s(e.message)};n.agm.invoke(o.SaveItemMethodName,{itemT42Ids:e}).then(function(e){return a(e)})["catch"](function(e){return c(e)})})},Manager.prototype.getItemAsMsg=function(e){var t=this;return new Promise(function(n,i){if(!r.isOutlookEnabled(t.agm))return void i('The method "getAsMsg" is not available');var a=(new Date).getTime().toString(),c=function(){s["default"].add(a,{resolve:n,reject:i})},u=function(e){i(e.message)},d={itemIds:e,callback:o.OutlookGetItemAsMsgMethodName,cookie:a};t.agm.invoke(o.CRMGetItemAsMsgMethodName,d).then(function(){return c()})["catch"](function(e){return u(e)})})},Manager.prototype.handleTrackingEmails=function(e,t,n){var s=this;return new Promise(function(c,u){if(!r.isOutlookEnabled(s.agm))return void u('The method "'+e+'" is not available');var d=n?i.validateId(n):null,l="track"===e,f=s.combineConversationIds(t,d,l),p=function(){if(c({emailIds:t,conversationIds:f}),!l){a["default"].remove(t);var e=t.filter(function(e){return"Outlook.ConversationId"===e.systemName});a["default"].add(t,e)}},h=function(e){u(e.message)},m=l?o.SyncTrackEmailMethodName:o.SyncUntrackEmailMethodName,g={emailIds:t,conversationIds:f};return s.agm.invoke(m,g).then(p)["catch"](h)})},Manager.prototype.validateIds=function(e){if(!e)throw new Error('"ids" are mandatory');if(!Array.isArray(e)||0===e.length)throw new Error("Invalid type of ids");return e.map(function(e){return i.validateId(e)})},Manager.prototype.combineConversationIds=function(e,t,n){var o=a["default"].containsIds(e)?a["default"].get(e):[];if(n){var i=t||r.generateConversationId();o.push(i),a["default"].containsIds(e)||a["default"].add(e,o)}return o},Manager}();t.Manager=c,t["default"]=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloseMethodName="T42.WordEditor.Closed",t.EditHtmlMethodName="T42.Word.HtmlEdit",t.ReceiveHtmlMethodName="T42.Word.HtmlReceive",t.ReturnHtmlMethodName="T42.Word.ReturnHtml",t.OnReturnHtmlMethodName="T42.Word.OnReturnHtml",t.ChunkSize=4e6},function(e,t,n){(function(t,r){!function(t,n){e.exports=n()}(0,function(){"use strict";function objectOrFunction(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function isFunction(e){return"function"==typeof e}function setScheduler(e){a=e}function setAsap(e){c=e}function useVertxTimer(){return void 0!==s?function(){s(flush)}:useSetTimeout()}function useSetTimeout(){var e=setTimeout;return function(){return e(flush,1)}}function flush(){for(var e=0;e<i;e+=2){(0,h[e])(h[e+1]),h[e]=undefined,h[e+1]=undefined}i=0}function then(e,t){var n=this,r=new this.constructor(noop);r[g]===undefined&&makePromise(r);var o=n._state;if(o){var i=arguments[o-1];c(function(){return invokeCallback(o,r,i,n._result)})}else subscribe(n,r,e,t);return r}function resolve$1(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(noop);return resolve(n,e),n}function noop(){}function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(e){try{return e.then}catch(e){return _.error=e,_}}function tryThen(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function handleForeignThenable(e,t,n){c(function(e){var r=!1,o=tryThen(n,t,function(n){r||(r=!0,t!==n?resolve(e,n):fulfill(e,n))},function(t){r||(r=!0,reject(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,reject(e,o))},e)}function handleOwnThenable(e,t){t._state===y?fulfill(e,t._result):t._state===b?reject(e,t._result):subscribe(t,undefined,function(t){return resolve(e,t)},function(t){return reject(e,t)})}function handleMaybeThenable(e,t,n){t.constructor===e.constructor&&n===then&&t.constructor.resolve===resolve$1?handleOwnThenable(e,t):n===_?(reject(e,_.error),_.error=null):n===undefined?fulfill(e,t):isFunction(n)?handleForeignThenable(e,t,n):fulfill(e,t)}function resolve(e,t){e===t?reject(e,selfFulfillment()):objectOrFunction(t)?handleMaybeThenable(e,t,getThen(t)):fulfill(e,t)}function publishRejection(e){e._onerror&&e._onerror(e._result),publish(e)}function fulfill(e,t){e._state===v&&(e._result=t,e._state=y,0!==e._subscribers.length&&c(publish,e))}function reject(e,t){e._state===v&&(e._state=b,e._result=t,c(publishRejection,e))}function subscribe(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+y]=n,o[i+b]=r,0===i&&e._state&&c(publish,e)}function publish(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?invokeCallback(n,r,o,i):o(i);e._subscribers.length=0}}function ErrorObject(){this.error=null}function tryCatch(e,t){try{return e(t)}catch(e){return S.error=e,S}}function invokeCallback(e,t,n,r){var o=isFunction(n),i=void 0,s=void 0,a=void 0,c=void 0;if(o){if(i=tryCatch(n,r),i===S?(c=!0,s=i.error,i.error=null):a=!0,t===i)return void reject(t,cannotReturnOwn())}else i=r,a=!0;t._state!==v||(o&&a?resolve(t,i):c?reject(t,s):e===y?fulfill(t,i):e===b&&reject(t,i))}function initializePromise(e,t){try{t(function(t){resolve(e,t)},function(t){reject(e,t)})}catch(t){reject(e,t)}}function nextId(){return w++}function makePromise(e){e[g]=w++,e._state=undefined,e._result=undefined,e._subscribers=[]}function validationError(){return new Error("Array Methods must be provided an Array")}function validationError(){return new Error("Array Methods must be provided an Array")}function all(e){return new M(this,e).promise}function race(e){var t=this;return new t(o(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function reject$1(e){var t=this,n=new t(noop);return reject(n,e),n}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function polyfill(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=I}var e=void 0;e=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var o=e,i=0,s=void 0,a=void 0,c=function(e,t){h[i]=e,h[i+1]=t,2===(i+=2)&&(a?a(flush):m())},u="undefined"!=typeof window?window:undefined,d=u||{},l=d.MutationObserver||d.WebKitMutationObserver,f="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,h=new Array(1e3),m=void 0;m=f?function(){return function(){return t.nextTick(flush)}}():l?function(){var e=0,t=new l(flush),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():p?function(){var e=new MessageChannel;return e.port1.onmessage=flush,function(){return e.port2.postMessage(0)}}():u===undefined?function(){try{var e=n(51);return s=e.runOnLoop||e.runOnContext,useVertxTimer()}catch(e){return useSetTimeout()}}():useSetTimeout();var g=Math.random().toString(36).substring(16),v=void 0,y=1,b=2,_=new ErrorObject,S=new ErrorObject,w=0,M=function(){function Enumerator(e,t){this._instanceConstructor=e,this.promise=new e(noop),this.promise[g]||makePromise(this.promise),o(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?fulfill(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&fulfill(this.promise,this._result))):reject(this.promise,validationError())}return Enumerator.prototype._enumerate=function(e){for(var t=0;this._state===v&&t<e.length;t++)this._eachEntry(e[t],t)},Enumerator.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===resolve$1){var o=getThen(e);if(o===then&&e._state!==v)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===I){var i=new n(noop);handleMaybeThenable(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},Enumerator.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===v&&(this._remaining--,e===b?reject(r,n):this._result[t]=n),0===this._remaining&&fulfill(r,this._result)},Enumerator.prototype._willSettleAt=function(e,t){var n=this;subscribe(e,undefined,function(e){return n._settledAt(y,t,e)},function(e){return n._settledAt(b,t,e)})},Enumerator}(),I=function(){function Promise(e){this[g]=nextId(),this._result=this._state=undefined,this._subscribers=[],noop!==e&&("function"!=typeof e&&needsResolver(),this instanceof Promise?initializePromise(this,e):needsNew())}return Promise.prototype["catch"]=function(e){return this.then(null,e)},Promise.prototype["finally"]=function(e){var t=this,n=t.constructor;return t.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})})},Promise}();return I.prototype.then=then,I.all=all,I.race=race,I.resolve=resolve$1,I.reject=reject$1,I._setScheduler=setScheduler,I._setAsap=setAsap,I._asap=c,I.polyfill=polyfill,I.Promise=I,I})}).call(t,n(21),n(31))},function(e,t,n){"use strict";function getColumnsAsJson(e){return e.map(function(e){var t={name:e.fieldName||"",text:e.header||e.fieldName,foregroundColor:e.foregroundColor||"",backgroundColor:e.backgroundColor||"",width:isNumber(e.width)?e.width:null};return e.validation&&(t.validation={type:"xlValidate"+e.validation.type,alert:"xlValidAlert"+e.validation.alert,list:e.validation.list||null}),t})}function getDataAsJson(e,t){return t.map(function(t){var n=[];return e.map(function(e){return e.fieldName}).forEach(function(e){return n.push(t[e]||"")}),{data:n}})}function getShowGridParams(e){var t={clearGrid:{default:!0,friendlyName:undefined},workbook:{default:o.generate(),friendlyName:undefined},dataWorksheet:{default:o.generate(),friendlyName:"worksheet"},templateWorkbook:undefined,viewWorksheet:{friendlyName:"templateWorksheet"},response:{default:"row",friendlyName:"payloadType"},inhibitLocalSave:undefined,glueMethod:{default:"ValidateShowGrid",friendlyName:undefined},buttonText:undefined,buttonRange:{default:"A1",friendlyName:undefined},topLeft:{default:"A1",friendlyName:undefined},triggers:{default:["save"],friendlyName:"updateTrigger"},dataRangeName:undefined,window:undefined,chunkSize:{default:1e3,friendlyName:undefined},disableErrorViewer:undefined,autostart:undefined,displayName:undefined,timeoutMs:undefined},n={};return e=e||{},Object.keys(t).forEach(function(r){var o=t[r],i=o?o.friendlyName:undefined,s=o?o["default"]:undefined;n[r]=i?e[i]:e[r],n[r]||(n[r]=s)}),n}function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function parseAgmResult(e){var t;try{t=JSON.parse(e.returned.result).success}catch(e){t=!1}return t}function convertParams(e,t,n,i){var s={columnsAsJSON:JSON.stringify(getColumnsAsJson(e)),dataAsJSON:JSON.stringify(getDataAsJson(e,t)),cookie:i||o.generate()},a={methodResponseTimeoutMs:n.timeoutMs},c=getShowGridParams(n),u=r({},s,c);return delete u.timeoutMs,{params:u,agmOptions:a}}var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(22);t.parseAgmResult=parseAgmResult,t.convertParams=convertParams},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function CreateItemDictionary(){this.items={}}return CreateItemDictionary.prototype.containsKey=function(e){return this.items.hasOwnProperty(e)},CreateItemDictionary.prototype.add=function(e,t){this.items[e]=t},CreateItemDictionary.prototype.remove=function(e){delete this.items[e]},CreateItemDictionary.prototype.get=function(e){return this.items[e]},CreateItemDictionary}();t.CreateItemDictionary=r,t["default"]=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function GetAttachmentDictionary(){this.items={}}return GetAttachmentDictionary.prototype.containsKey=function(e){return this.items.hasOwnProperty(e)},GetAttachmentDictionary.prototype.add=function(e,t){this.items[e]=t},GetAttachmentDictionary.prototype.remove=function(e){delete this.items[e]},GetAttachmentDictionary.prototype.get=function(e){return this.items[e]},GetAttachmentDictionary}();t.GetAttachmentDictionary=r,t["default"]=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function GetItemAsMsgDictionary(){this.items={}}return GetItemAsMsgDictionary.prototype.containsKey=function(e){return this.items.hasOwnProperty(e)},GetItemAsMsgDictionary.prototype.add=function(e,t){this.items[e]=t},GetItemAsMsgDictionary.prototype.remove=function(e){delete this.items[e]},GetItemAsMsgDictionary.prototype.get=function(e){return this.items[e]},GetItemAsMsgDictionary}();t.GetItemAsMsgDictionary=r,t["default"]=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function TrackEmailDictionary(){this.items={}}return TrackEmailDictionary.prototype.containsIds=function(e){var t=this.getOutlookId(e);return this.items.hasOwnProperty(t)},TrackEmailDictionary.prototype.add=function(e,t){var n=this.getOutlookId(e);this.items[n]=t},TrackEmailDictionary.prototype.remove=function(e){var t=this.getOutlookId(e);delete this.items[t]},TrackEmailDictionary.prototype.get=function(e){var t=this.getOutlookId(e);return this.items[t]},TrackEmailDictionary.prototype.getOutlookId=function(e){return e.filter(function(e){return 0===e.systemName.indexOf("Outlook")})[0].nativeId},TrackEmailDictionary}();t.TrackEmailDictionary=r,t["default"]=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function TrackItemDictionary(){this.items={}}return TrackItemDictionary.prototype.containsIds=function(e){var t=this.getOutlookId(e);return this.items.hasOwnProperty(t)},TrackItemDictionary.prototype.add=function(e,t){var n=this.getOutlookId(e);this.items[n]=t},TrackItemDictionary.prototype.remove=function(e){var t=this.getOutlookId(e);delete this.items[t]},TrackItemDictionary.prototype.get=function(e){var t=this.getOutlookId(e);return this.items[t]},TrackItemDictionary.prototype.getOutlookId=function(e){return e.filter(function(e){return 0===e.systemName.indexOf("Outlook")})[0].nativeId},TrackItemDictionary}();t.TrackItemDictionary=r,t["default"]=new r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},i=this;Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),a=n(1),c=n(0),u=n(11);t.createItem=function(e,t,n,l){var p="email"===n,h="task"===n;l=l||{};var m=l.onCanceled;return new Promise(function(g,v){var y=d(t);s.validateNewItemOptions(l);var b=(new Date).getTime().toString(),_={ItemType:n,Cookie:b,OnSendMethod:a.OnSendMethodName,OnCancelMethod:a.OnCancelMethodName};p?_.t42value=c.convertToT42Email(y):h&&(_.t42value=c.convertToT42Task(y));var S=function(){var e=p?l.onSent:l.onSaved;u["default"].add(b,{onSent:e,onCanceled:m}),g()},w=function(e){v(e.message)},M=function(t){var n=t.returned;e.invoke(a.ShowItemMethodName,n).then(S)["catch"](w)},I=y.attachments;if(I&&I.length>0){p?_.t42value.attachments=[]:_.AttachFiles=[];"string"==typeof I[0].data?Promise.all(I.map(function(t){return r(i,void 0,void 0,function(){return o(this,function(n){return t.truncate=!0,t.encoding="base64",new Blob([t.data]).size>1e6?[2,f(e,t,t.data,p,_)]:[2,e.invoke(a.TmpFilesAppendMethodName,t).then(function(e){var t=e.returned.Filename;p?_.t42value.attachments.push({name:t}):_.AttachFiles.push(t)})["catch"](function(e){return window.console.warn("Not able to create attachment file")})]})})})).then(function(){e.invoke(a.CreateItemMethodName,_).then(M)["catch"](function(e){return v(e.message)})})["catch"](function(e){return v(e.message)}):"string"==typeof I[0]?(I.map(function(e){return p?_.t42value.attachments.push({name:e}):_.AttachFiles.push(e)}),e.invoke(a.CreateItemMethodName,_).then(M)["catch"](function(e){return v(e.message)})):v(c.attachmentsErrorMessage)}else e.invoke(a.CreateItemMethodName,_).then(M)["catch"](function(e){return v(e.message)})})};var d=function(e){var t=l(e);return t.attachments&&(t.attachments=s.validateAttachments(e.attachments)),t.startDate&&(t.startDate=s.validateDate(t.startDate,"startDate")),t.dueDate&&(t.dueDate=s.validateDate(t.dueDate,"dueDate")),t.reminderTime&&(t.reminderTime=s.validateDate(t.reminderTime,"reminderTime")),t.priority&&(t.priority=s.validatePriority(t.priority)),t},l=function(e){var t=Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},{});return t.subject&&(t.subject=t.subject.toString()),t.body&&(t.body=t.body.toString()),t.bodyHtml&&(t.bodyHtml=t.bodyHtml.toString()),t.sender&&t.sender.toString(),t},f=function(e,t,n,r,o){return new Promise(function(i){var s=h(t,n),a=s.chunkFile,c=s.chunkData;p(e,a,c,i,r,o)})},p=function(e,t,n,r,o,i){e.invoke(a.TmpFilesAppendMethodName,t).then(function(s){if(n.length>0){t.truncate=!1;var a=h(t,n),c=a.chunkFile,u=a.chunkData;return p(e,c,u,r,o,i)}var d=s.returned.Filename;o?i.t42value.attachments.push({name:d}):i.AttachFiles.push(d),r()})["catch"](function(){window.console.warn("Not able to create attachment file")})},h=function(e,t){return e.data=t.slice(0,8e5),t=t.slice(8e5,t.length),{chunkFile:e,chunkData:t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(5),i=n(0),s=function(){function TaskImpl(e,t){var n=this;e.attachments&&e.attachments.length>0&&(this.attachments=[],e.attachments.forEach(function(e){n.attachments.push(new o.AttachmentImpl(e,t,n))})),this.actualWork=e.actualWork,this.body=e.body,this.creationTime=e.creationTime,this.dateCompleted=e.dateCompleted,this.dueDate=e.dueDate,this.ids=e.ids,this.priority=i.getTaskPriority(e.importance),this.reminderTime=e.reminderTime,this.startDate=e.startDate,this.subject=e.subject,this.entityType=e.entityType}return TaskImpl.prototype.show=function(){return r["default"].showItemMethod(this.ids,"showTask")},TaskImpl.prototype.saveToFile=function(){return r["default"].saveItemMethod(this.ids,"saveTask")},TaskImpl}();t.TaskImpl=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(17),i=n(0),s=n(1),a=n(11),c=n(12),u=n(38),d=n(13),l=n(14),f=n(15),p=function(e,t){return e.register(s.OnEmailReceivedMethodName,function(n){var o=new r.EmailImpl(n.email,e);return t.execute("onEmailReceived",o),{email:o}})},h=function(e,t){return e.register(s.OnTaskCreatedMethodName,function(n){var r=new o.TaskImpl(n,e);return t.execute("onTaskCreated",r),{task:r}})},m=function(e){return e.register(s.OnSendMethodName,function(t){var n=t.cookie,i=t.email,s=t.task;if(a["default"].containsKey(n)&&"function"==typeof a["default"].get(n).onSent)return i&&!s?(a["default"].get(n).onSent(new r.EmailImpl(i,e)),{cookie:n,email:i}):!i&&s?(a["default"].get(n).onSent(new o.TaskImpl(s,e)),{cookie:n,task:s}):void a["default"].remove(n)})},g=function(e){return e.register(s.OnCancelMethodName,function(e){var t=e.cookie;if(a["default"].containsKey(t)&&"function"==typeof a["default"].get(t).onCanceled)return a["default"].get(t).onCanceled(),a["default"].remove(t),{cookie:t}})},v=function(e,t){var n=i.concatChunkData(u["default"].get(t));e.containsKey(t)&&e.get(t).resolve(i.decodeData(n)),u["default"].remove(t),e.remove(t)},y=function(e,t,n){e.containsKey(t)&&e.get(t).reject(n),u["default"].remove(t),e.remove(t)},b=function(e,t){e<=100&&c["default"].containsKey(t)&&"function"==typeof c["default"].get(t).callback&&c["default"].get(t).callback(e)},_=function(e){var t=0;return e.register(s.OutlookGetAttachmentMethodName,function(e){var n=e.cookie,r=e.data,o=e.errorMessage,i=e.success,s=e.more,a=e.length,d=e.totalLength;return u["default"].add(n,r),i?(t+=a/d*100,b(t,n),s||(t<100&&b(100,n),t=0,v(c["default"],n))):(t=0,y(c["default"],n,o)),{}})},S=function(e){return e.register(s.OutlookGetItemAsMsgMethodName,function(e){var t=e.cookie,n=e.data,r=e.errorMessage,o=e.success,i=e.more;return u["default"].add(t,n),o?i||v(d["default"],t):y(d["default"],t,r),{}})};t.registerCRMTrackEmail=function(e,t){return e.register(s.OnTrackEmailMethodName,function(n){var o=n.conversationIds,i=new r.EmailImpl(n.email,e);return l["default"].add(i.ids,o),t.execute("onEmailTracked",{conversationIds:o,email:i}),{}})},t.registerCRMUntrackEmail=function(e,t){return e.register(s.OnUntrackEmailMethodName,function(e){var n=e.conversationIds,r=e.emailIds;return t.execute("onEmailUntracked",{conversationIds:n,emailIds:r}),{}})},t.registerCRMTrackItem=function(e,t){return e.register(s.OnTrackItemMethodName,function(e){var n=e.conversationIds,r=e.item;return f["default"].add(r.ids,n),t.execute("onItemTracked",{conversationIds:n,event:r}),{conversationIds:n,event:r}})},t.registerCRMUntrackItem=function(e,t){return e.register(s.OnUntrackItemMethodName,function(e){var n=e.conversationIds,r=e.itemIds;return t.execute("onItemUntracked",{conversationIds:n,eventIds:r}),{conversationIds:n,eventIds:r}})};var w=function(e,t){return e.register(s.SecureReplyMethodName,function(n){var o=new r.EmailImpl(n.inReplyToMail,e);return t.execute("onSecureReply",o),{email:o}})},M=function(e,t){return e.register(s.DisplaySecureMailMethodName,function(n){var o=new r.EmailImpl(n.inReplyToMail,e);return t.execute("onDisplaySecureEmail",o),{email:o}})};t.registerAgmMethods=function(e,t){p(e,t),h(e,t),m(e),g(e),S(e),_(e),w(e,t),M(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),o=n(49),i=n(35),s=n(39),a=n(9),c=n(20),u=n(32);t["default"]=function(e){function createOutlook(e){if(t.outlook)return s["default"]({agm:e.agm})}function createExcel(e){if(t.excel)return i["default"]({agm:e.agm})}function createWord(e){if(t.word)return o["default"]({agm:e.agm})}e=e||{};var t=u["default"](e),n={libs:[{name:"outlook",create:createOutlook},{name:"excel",create:createExcel},{name:"word",create:createWord}],version:c.version,enrichGlue:function(e){e.config.outlook=t.outlook,e.config.excel=t.excel,e.config.word=t.word}};return e.glue?(function(e){e.outlook=createOutlook(e),e.excel=createExcel(e),e.word=createWord(e),n.enrichGlue(e)}(e.glue),a.Promise.resolve(e.glue)):r["default"](e,n)}},function(e,t){e.exports={name:"glue4office",version:"1.4.5",description:"glue for office",main:"dist/node/glue4office.js",browser:"dist/web/glue4office.js",types:"glue4office.d.ts",docName:"Glue4Office",scripts:{clean:"node ./build/scripts/clean.js","pre:build":"npm run tslint && tsc && set NODE_ENV=development && npm run clean","file-versionify":"node ./build/scripts/file-versionify.js",tslint:"tslint -t codeFrame ./src/**/*.ts","tslint:fix":"tslint -t codeFrame --fix ./src/**/*.ts",watch:"onchange ./src/**/*.ts -- npm run build:dev","build:dev":"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify","build:prod":"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify",docs:"typedoc --options typedoc.json ./src","generate-docs":"glue-js-documentation-builder build-reference --project g4o --modules ./glue4office.d.ts,./node_modules/tick42-glue-core/glue.d.ts",prepublish:"npm update && npm run build:prod"},author:"Tick42",license:"ISC",precommit:"tslint",devDependencies:{"@types/node":"9.6.21","es6-promise":"4.2.2","glue-js-documentation-builder":"2.0.1",onchange:"3.3.0","pre-commit":"1.1.3",shelljs:"0.6.0","tick42-webpack-config":"4.1.6",tslint:"5.8.0",typescript:"2.9.1",webpack:"2.3.3"},dependencies:{"callback-registry":"2.4.0",shortid:"2.2.6","tick42-glue-core":"4.1.5"}}},function(e,t){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(n===setTimeout)return setTimeout(e,0);if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function runClearTimeout(e){if(r===clearTimeout)return clearTimeout(e);if((r===defaultClearTimeout||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}function cleanUpNextTick(){a&&i&&(a=!1,i.length?s=i.concat(s):c=-1,s.length&&drainQueue())}function drainQueue(){if(!a){var e=runTimeout(cleanUpNextTick);a=!0;for(var t=s.length;t;){for(i=s,s=[];++c<t;)i&&i[c].run();c=-1,t=s.length}i=null,a=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var n,r,o=e.exports={};!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){n=defaultSetTimout}try{r="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){r=defaultClearTimeout}}();var i,s=[],a=!1,c=-1;o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new Item(e,t)),1!==s.length||a||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=noop,o.addListener=noop,o.once=noop,o.off=noop,o.removeListener=noop,o.removeAllListeners=noop,o.emit=noop,o.prependListener=noop,o.prependOnceListener=noop,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";e.exports=n(25)},function(e,t,n){"use strict";function decode(e){var t=r.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}var r=n(4);e.exports=decode},function(e,t,n){"use strict";function encode(e,t){for(var n,o=0,i="";!n;)i+=e(t>>4*o&15|r()),n=t<Math.pow(16,o+1),o++;return i}var r=n(27);e.exports=encode},function(e,t,n){"use strict";function generate(){var e="",t=Math.floor(.001*(Date.now()-u));return t===o?r++:(r=0,o=t),e+=s(i.lookup,d),e+=s(i.lookup,l),r>0&&(e+=s(i.lookup,r)),e+=s(i.lookup,t)}function seed(t){return i.seed(t),e.exports}function worker(t){return l=t,e.exports}function characters(e){return e!==undefined&&i.characters(e),i.shuffled()}var r,o,i=n(4),s=n(24),a=n(23),c=n(26),u=1459707606518,d=6,l=n(29)||0;e.exports=generate,e.exports.generate=generate,e.exports.seed=seed,e.exports.worker=worker,e.exports.characters=characters,e.exports.decode=a,e.exports.isValid=c},function(e,t,n){"use strict";function isShortId(e){if(!e||"string"!=typeof e||e.length<6)return!1;for(var t=r.characters(),n=e.length,o=0;o<n;o++)if(-1===t.indexOf(e[o]))return!1;return!0}var r=n(4);e.exports=isShortId},function(e,t,n){"use strict";function randomByte(){if(!r||!r.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return r.getRandomValues(e),48&e[0]}var r="object"==typeof window&&(window.crypto||window.msCrypto);e.exports=randomByte},function(e,t,n){"use strict";function getNextValue(){return(r=(9301*r+49297)%233280)/233280}function setSeed(e){r=e}var r=1;e.exports={nextValue:getNextValue,seed:setSeed}},function(e,t,n){"use strict";e.exports=0},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=69)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={DEFAULT:0,STRING:1,NUMBER:2,COUNT:3,RATE:4,STATISTICS:6,TIMESTAMP:7,ADDRESS:8,TIMESPAN:10,OBJECT:11}},function(e,t,n){"use strict";function createRegistry(e){function add(e,t){var r=n[e];return r||(r=[],n[e]=r),r.push(t),function(){var r=n[e];r&&(r=r.reduce(function(e,n,r){return n===t&&e.length===r||e.push(n),e},[]),n[e]=r)}}function execute(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=n[e];if(!o||0===o.length)return[];var i=[];return o.forEach(function(n){try{var r=n.apply(undefined,t);i.push(r)}catch(t){i.push(undefined),_handleError(t,e)}}),i}function _handleError(n,r){var o=n instanceof Error?n:new Error(n);if(t)return void t(o);var i='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+o.stack;if(e)switch(e.errorHandling){case"log":return console.error(i);case"silent":return;case"throw":throw new Error(i)}console.error(i)}function clear(){n={}}if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};return{add:add,execute:execute,clear:clear}}createRegistry["default"]=createRegistry,e.exports=createRegistry},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={validate:function(e,t,n){if(null===e||"object"!=typeof e)throw new Error("Missing definition");if(null===t||"object"!=typeof t)throw new Error("Missing parent");if(null===n||"object"!=typeof n)throw new Error("Missing transport")}}},function(e,t,n){"use strict";function reset(){i=!1}function setCharacters(e){if(!e)return void(r!==a&&(r=a,reset()));if(e!==r){if(e.length!==a.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. These characters were not unique: "+t.join(", "));r=e,reset()}}function characters(e){return setCharacters(e),r}function setSeed(e){s.seed(e),o!==e&&(reset(),o=e)}function shuffle(){r||setCharacters(a);for(var e,t=r.split(""),n=[],o=s.nextValue();t.length>0;)o=s.nextValue(),e=Math.floor(o*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function getShuffled(){return i||(i=shuffle())}function lookup(e){return getShuffled()[e]}function get(){return r||a}var r,o,i,s=n(23),a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";e.exports={get:get,characters:characters,seed:setSeed,lookup:lookup,shuffled:getShuffled}},function(e,t,n){"use strict";e.exports=n(20)},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function default_1(e,t,n){if("function"!=typeof t&&"function"!=typeof n)return e;"function"!=typeof t?t=function(){}:"function"!=typeof n&&(n=function(){}),e.then(t,n)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function ServerSubscription(e,t,n){this.protocol=e,this.repoMethod=t,this.subscription=n}return Object.defineProperty(ServerSubscription.prototype,"stream",{get:function(){return this.repoMethod.stream},enumerable:!0,configurable:!0}),Object.defineProperty(ServerSubscription.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(ServerSubscription.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!0,configurable:!0}),Object.defineProperty(ServerSubscription.prototype,"instance",{get:function(){return this.subscription.instance},enumerable:!0,configurable:!0}),ServerSubscription.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},ServerSubscription.prototype.push=function(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)},ServerSubscription}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);t.ContextMessageReplaySpec={get name(){return"context"},get types(){return[r.GW_MESSAGE_CREATE_CONTEXT,r.GW_MESSAGE_ACTIVITY_CREATED,r.GW_MESSAGE_ACTIVITY_DESTROYED,r.GW_MESSAGE_CONTEXT_CREATED,r.GW_MESSAGE_CONTEXT_ADDED,r.GW_MESSAGE_SUBSCRIBE_CONTEXT,r.GW_MESSAGE_SUBSCRIBED_CONTEXT,r.GW_MESSAGE_UNSUBSCRIBE_CONTEXT,r.GW_MESSAGE_DESTROY_CONTEXT,r.GW_MESSAGE_CONTEXT_DESTROYED,r.GW_MESSAGE_UPDATE_CONTEXT,r.GW_MESSAGE_CONTEXT_UPDATED,r.GW_MESSAGE_JOINED_ACTIVITY]}}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function Utils(){}return Utils.getGDMajorVersion=function(){if("undefined"==typeof window)return-1;if(!window.glueDesktop)return-1;if(!window.glueDesktop.version)return-1;var e=Number(window.glueDesktop.version.substr(0,1));return isNaN(e)?-1:e},Utils.isNode=function(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}},Utils}();t["default"]=n}).call(t,n(5))},function(e,t){e.exports={name:"tick42-glue-core",version:"4.1.5",description:"Glue42 core library including logger, connection, agm and metrics",main:"./dist/node/tick42-glue-core.js",types:"./glue.d.ts",browser:"./dist/web/tick42-glue-core.js",scripts:{"init-dev-mode":"node ./build/scripts/init-dev-mode.js","remove-installed-dependencies":"node ./build/scripts/remove-installed-dependencies.js",clean:"node ./build/scripts/clean.js","pre:build":"npm run clean && npm run tslint && tsc && set NODE_ENV=development","file-versionify":"node ./build/scripts/file-versionify.js",tslint:"tslint -t codeFrame ./src/**.ts","tslint:fix":"tslint -t codeFrame --fix ./src/**.ts",watch:"onchange ./src/**/*.ts -- npm run build:dev","build:dev":"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify","build:prod":"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify",docs:"typedoc --options typedoc.json ./src",prepublish:"npm run build:prod && npm run test:only",test:"npm run build:dev && npm run test:only","test:only":"mocha ./tests/ --recursive","test:core":"mocha ./tests/core","test:agm":"mocha ./tests/agm"},repository:{type:"git",url:"https://stash.tick42.com/scm/tg/js-glue-core.git"},author:{name:"Tick42",url:"http://www.glue42.com"},license:"ISC",dependencies:{"callback-registry":"^2.4.0","es6-promise":"^4.1.0",shortid:"^2.2.6","util-deprecate":"^1.0.2",ws:"^0.7.2"},devDependencies:{"@types/node":"^10.7.0","@types/shortid":"0.0.29",archiver:"^1.3.0","babel-core":"^6.25.0","babel-loader":"^6.4.1","babel-plugin-add-module-exports":"^0.2.1","babel-preset-es2015":"^6.16.0","babel-preset-stage-2":"^6.22.0",chai:"^4.0.2","deep-equal":"^1.0.1",mocha:"^2.5.3",onchange:"3.*","pre-commit":"^1.1.3","readline-sync":"^1.4.5",shelljs:"^0.6.0","tick42-gateway":"^0.2.2","tick42-webpack-config":"4.1.6",tslint:"^5.11.0",typescript:"^3.0.1",webpack:"2.3.3"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4);t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function ConnectionImpl(e){this.messageHandlers={},this.ids=1,this.registry=r["default"](),this._connected=!1,this._settings=e,this._logger=e.logger}return ConnectionImpl.prototype.init=function(e,t){this._protocol=t,this._transport=e,this._transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),this._transport.onMessage(this.handleTransportMessage.bind(this))},ConnectionImpl.prototype.send=function(e,t,n,r,o){if(this._transport.isObjectBasedTransport){var i=this._protocol.createObjectMessage(e,t,n,r);return this._transport.sendObject(i,e,t,o)}var s=this._protocol.createStringMessage(e,t,n,r);return this._transport.send(s,e,t,o)},ConnectionImpl.prototype.on=function(e,t,n){t=t.toLowerCase(),this.messageHandlers[t]===undefined&&(this.messageHandlers[t]={});var r=this.ids++;return this.messageHandlers[t][r]=n,{type:t,id:r}},ConnectionImpl.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(ConnectionImpl.prototype,"isConnected",{get:function(){return this._connected},enumerable:!0,configurable:!0}),ConnectionImpl.prototype.connected=function(e){return this._connected&&e(this._settings.ws||this._settings.http),this.registry.add("connected",e)},ConnectionImpl.prototype.disconnected=function(e){return this.registry.add("disconnected",e)},ConnectionImpl.prototype.login=function(e){return this._transport.open(),this._protocol.login(e)},ConnectionImpl.prototype.logout=function(){this._protocol.logout(),this._transport.close()},ConnectionImpl.prototype.loggedIn=function(e){return this._protocol.loggedIn(e)},Object.defineProperty(ConnectionImpl.prototype,"protocolVersion",{get:function(){return this._settings.protocolVersion||1},enumerable:!0,configurable:!0}),ConnectionImpl.prototype.toAPI=function(){var e=this;return{send:e.send.bind(e),on:e.on.bind(e),off:e.off.bind(e),login:e.login.bind(e),logout:e.logout.bind(e),loggedIn:e.loggedIn.bind(e),connected:e.connected.bind(e),disconnected:e.disconnected.bind(e),get protocolVersion(){return e.protocolVersion}}},ConnectionImpl.prototype.distributeMessage=function(e,t){var n=this,r=this.messageHandlers[t.toLowerCase()];r!==undefined&&Object.keys(r).forEach(function(t){var o=r[t];if(o!==undefined)try{o(e)}catch(e){n._logger.error("Message handler failed with "+e.stack)}})},ConnectionImpl.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?this.registry.execute("connected"):this.registry.execute("disconnected"))},ConnectionImpl.prototype.handleTransportMessage=function(e){var t;t="string"==typeof e?this._protocol.processStringMessage(e):this._protocol.processObjectMessage(e),this.distributeMessage(t.msg,t.msgType)},ConnectionImpl}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GW_MESSAGE_CREATE_CONTEXT="create-context",t.GW_MESSAGE_ACTIVITY_CREATED="created",t.GW_MESSAGE_ACTIVITY_DESTROYED="destroyed",t.GW_MESSAGE_CONTEXT_CREATED="context-created",t.GW_MESSAGE_CONTEXT_ADDED="context-added",t.GW_MESSAGE_SUBSCRIBE_CONTEXT="subscribe-context",t.GW_MESSAGE_SUBSCRIBED_CONTEXT="subscribed-context",t.GW_MESSAGE_UNSUBSCRIBE_CONTEXT="unsubscribe-context",t.GW_MESSAGE_DESTROY_CONTEXT="destroy-context",t.GW_MESSAGE_CONTEXT_DESTROYED="context-destroyed",t.GW_MESSAGE_UPDATE_CONTEXT="update-context",t.GW_MESSAGE_CONTEXT_UPDATED="context-updated",t.GW_MESSAGE_JOINED_ACTIVITY="joined"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={protocolVersion:-1,send:function(e,t,n,r,o){return Promise.resolve(undefined)},on:function(e,t,n){return{type:"1",id:1}},off:function(e){},login:function(e){return undefined},logout:function(){},loggedIn:function(e){return undefined},connected:function(e){return undefined},disconnected:function(e){return undefined}};t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(83),o=n(52),i=n(68),s=n(34),a=n(50),c=n(14),u=n(86),d=n(9),l=n(14),f=n(65),p=n(8),h=n(49),m=function(e,t){function registerLib(e,t,n){t.initStartTime=n.startTime,t.ready?t.ready().then(function(){t.initTime=n.stop(),t.initEndTime=n.endTime}):(t.initTime=n.stop(),t.initEndTime=n.endTime),k[e]=t,m[e]=t}function setupConnection(){var e=u["default"]();C.connection.logger=S.subLogger("connection"),b=o["default"](C.connection);var t=Promise.resolve(C.auth);if(C.connection&&!C.auth){var n=C.connection.protocolVersion;if(!n||1===n)return registerLib("connection",b,e),Promise.resolve({});if(2===n)return Promise.reject("You need to provide auth information");3===n&&(t=g?g.getGWToken().then(function(e){return{gatewayToken:e}}):Promise.reject("You need to provide auth information"))}return t.then(function(e){var t;if("string"==typeof e||"number"==typeof e)t={token:e};else{if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("Invalid auth object - "+JSON.stringify(e));t=e}return t}).then(function(e){return b.login(e)}).then(function(t){return t&&(t.machine&&(C.agm.instance.machine=t.machine),t.user&&(C.agm.instance.user=t.user)),registerLib("connection",b,e),C})["catch"](function(){return b&&b.logout(),C})}function setupMetrics(){if(C.metrics){var e=u["default"]();w=r["default"]({identity:C.metrics.identity,connection:C.metrics?b:c["default"],logger:S.subLogger("metrics")}),M=w.subSystem("App");var t,n=M.subSystem("reporting"),o={name:"features",conflation:1};M.featureMetric=function(e,r,i){if(void 0===e||""===e)throw new Error("name is mandatory");if(void 0===r||""===r)throw new Error("action is mandatory");if(void 0===i||""===i)throw new Error("payload is mandatory");t?t.update({name:e,action:r,payload:i}):t=n.objectMetric(o,{name:e,action:r,payload:i})},S.metricsLevel("warn",M.parent.subSystem("LogEvents")),registerLib("metrics",M,e)}return Promise.resolve(undefined)}function setupAGM(){var e=u["default"](),t={instance:C.agm.instance,connection:b,logger:S.subLogger("agm"),forceGW:C.connection&&C.connection.force,gdVersion:v};return new Promise(function(n,r){s["default"](t).then(function(t){_=t,registerLib("agm",_,e),n(C)})["catch"](function(e){return r(e)})})}function setupContexts(){var e=C.activities&&3===l["default"].protocolVersion;if(C.contexts||e){var t=u["default"]();return I=new f.ContextsModule({connection:b,logger:S.subLogger("contexts"),gdMajorVersion:v}),registerLib("contexts",I,t),I}var n=l["default"].replayer;n&&n.drain(p.ContextMessageReplaySpec.name,null)}function setupChannels(){var e=u["default"]();return T=h.factory(I,_),registerLib("channels",T,e),Promise.resolve(undefined)}function setupExternalLibs(e){try{return e.forEach(function(e){setupExternalLib(e.name,e.create)}),Promise.resolve()}catch(e){return Promise.reject(e)}}function setupExternalLib(e,t){var n=u["default"](),r=t(k);r&&registerLib(e,r,n)}function waitForLibs(){var e=Object.keys(k).map(function(e){var t=k[e];return t.ready?t.ready():Promise.resolve()});return Promise.all(e)}function constructGlueObject(){var r=function(){_&&_.invoke("T42.ACS.Feedback",{},"best")},o={glueVersion:C.version};y.stop();var i={feedback:r,info:o,version:C.version,userConfig:e,done:function(){return b.logout(),Promise.resolve()}};if(i.performance={get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var e=Object.keys(i).filter(function(e){return"initTimes"!==e&&i[e].initTime}).map(function(e){return{name:e,time:i[e].initTime,startTime:i[e].initStartTime,endTime:i[e].initEndTime}});return e.push({name:"glue",startTime:y.startTime,endTime:y.endTime,time:y.period}),e}},Object.keys(k).forEach(function(e){var t=k[e];i[e]=t,o[e]=t.version}),n&&n.perfDataNeeded&&n.updatePerfData){var s=n.perfDataDelay||100;setTimeout(function(){n.updatePerfData(i.performance)},s)}return i.config={},t.enrichGlue&&t.enrichGlue(i),Object.keys(C).forEach(function(e){i.config[e]=C[e]}),t.extOptions&&Object.keys(t.extOptions).forEach(function(e){i.config[e]=t.extOptions[e]}),i}var n,g,v=-1;"undefined"!=typeof window&&(v=d["default"].getGDMajorVersion(),2===v?n=window.htmlContainer:v>=3&&(g=window.glue42gd));var y=u["default"]();e=e||{},t=t||{};var b,_,S,w,M,I,T,C=a["default"](e,t,n,g,v),k={};return function(){var e=u["default"](),t={identity:C.identity,getConnection:function(){return b||c["default"]},publish:C.logger.publish||"off",console:C.logger.console||"info",metrics:C.metrics&&C.logger.metrics||"off"};return S=i["default"](t),registerLib("logger",S,e),Promise.resolve(undefined)}().then(setupConnection).then(function(){return Promise.all([setupMetrics(),setupAGM(),setupContexts()])}).then(function(){return setupChannels()}).then(function(){return setupExternalLibs(C.libs||[])}).then(waitForLibs).then(constructGlueObject)["catch"](function(e){return Promise.reject({err:e,libs:k})})};t["default"]=m},function(e,t){e.exports=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,o=Math.ceil(1.6*r*n/t.length),i="";;)for(var s=e(o),a=0;a<o;a++){var c=s[a]&r;if(t[c]&&(i+=t[c],i.length===n))return i}}},function(e,t){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(n===setTimeout)return setTimeout(e,0);if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function runClearTimeout(e){if(r===clearTimeout)return clearTimeout(e);if((r===defaultClearTimeout||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}function cleanUpNextTick(){a&&i&&(a=!1,i.length?s=i.concat(s):c=-1,s.length&&drainQueue())}function drainQueue(){if(!a){var e=runTimeout(cleanUpNextTick);a=!0;for(var t=s.length;t;){for(i=s,s=[];++c<t;)i&&i[c].run();c=-1,t=s.length}i=null,a=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var n,r,o=e.exports={};!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){n=defaultSetTimout}try{r="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){r=defaultClearTimeout}}();var i,s=[],a=!1,c=-1;o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new Item(e,t)),1!==s.length||a||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=noop,o.addListener=noop,o.once=noop,o.off=noop,o.removeListener=noop,o.removeAllListeners=noop,o.emit=noop,o.prependListener=noop,o.prependOnceListener=noop,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";function build(e){var t="",n=Math.floor(.001*(Date.now()-s));return n===o?r++:(r=0,o=n),t+=i(a),t+=i(e),r>0&&(t+=i(r)),t+=i(n)}var r,o,i=n(19),s=(n(3),1459707606518),a=6;e.exports=build},function(e,t,n){"use strict";function generate(e){for(var t,n=0,s="";!t;)s+=i(o,r.get(),1),t=e<Math.pow(16,n+1),n++;return s}var r=n(3),o=n(22),i=n(16);e.exports=generate},function(e,t,n){"use strict";function seed(t){return r.seed(t),e.exports}function worker(t){return s=t,e.exports}function characters(e){return e!==undefined&&r.characters(e),r.shuffled()}function generate(){return o(s)}var r=n(3),o=n(18),i=n(21),s=n(24)||0;e.exports=generate,e.exports.generate=generate,e.exports.seed=seed,e.exports.worker=worker,e.exports.characters=characters,e.exports.isValid=i},function(e,t,n){"use strict";function isShortId(e){return!(!e||"string"!=typeof e||e.length<6)&&!new RegExp("[^"+r.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}var r=n(3);e.exports=isShortId},function(e,t,n){"use strict";var r,o="object"==typeof window&&(window.crypto||window.msCrypto);r=o&&o.getRandomValues?function(e){return o.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t},e.exports=r},function(e,t,n){"use strict";function getNextValue(){return(r=(9301*r+49297)%233280)/233280}function setSeed(e){r=e}var r=1;e.exports={nextValue:getNextValue,seed:setSeed}},function(e,t,n){"use strict";e.exports=0},function(e,t){function ws(e,t,n){return t?new r(e,t):new r(e)}var n=function(){return this}(),r=n.WebSocket||n.MozWebSocket;e.exports=r?ws:null,r&&(ws.prototype=r.prototype)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),o=n(43),i=function(){function AGMImpl(e,t,n,i,s){this.protocol=e,this.clientRepository=t,this.serverRepository=n,this.instance=i,this.configuration=s,this.client=new r["default"](e,t,i,s),this.server=new o["default"](e,n,i,s)}return AGMImpl.prototype.serverRemoved=function(e){return this.client.serverRemoved(e)},AGMImpl.prototype.serverAdded=function(e){return this.client.serverAdded(e)},AGMImpl.prototype.serverMethodRemoved=function(e){return this.client.serverMethodRemoved(e)},AGMImpl.prototype.serverMethodAdded=function(e){return this.client.serverMethodAdded(e)},AGMImpl.prototype.methodRemoved=function(e){return this.client.methodRemoved(e)},AGMImpl.prototype.methodAdded=function(e){return this.client.methodAdded(e)},AGMImpl.prototype.methodsForInstance=function(e){return this.client.methodsForInstance(e)},AGMImpl.prototype.methods=function(e){return this.client.methods(e)},AGMImpl.prototype.servers=function(e){return this.client.servers(e)},AGMImpl.prototype.subscribe=function(e,t,n,r){return this.client.subscribe(e,t,n,r)},AGMImpl.prototype.createStream=function(e,t,n,r){return this.server.createStream(e,t,n,r)},AGMImpl.prototype.unregister=function(e){return this.server.unregister(e)},AGMImpl.prototype.registerAsync=function(e,t){return this.server.registerAsync(e,t)},AGMImpl.prototype.register=function(e,t){return this.server.register(e,t)},AGMImpl.prototype.invoke=function(e,t,n,r,o,i){return this.client.invoke(e,t,n,r,o,i)},AGMImpl.prototype.updateInstance=function(e){this.instance.machine===undefined&&(this.instance.machine=e.MachineName||e.machine),this.instance.user===undefined&&(this.instance.user=e.UserName||e.user),this.instance.environment===undefined&&(this.instance.environment=e.Environment||e.environment),this.instance.region===undefined&&(this.instance.region=e.Region||e.region)},AGMImpl}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(28),o=n(6),i=function(){function Client(e,t,n,o){this.protocol=e,this.repo=t,this.instance=n,this.configuration=o,this.clientInvocations=new r["default"](e)}return Client.prototype.subscribe=function(e,t,n,r){var i=this,s=function(e,n,r,o){i.protocol.client.subscribe(n,t.arguments,e,{methodResponseTimeout:t.waitTimeoutMs},r,o)},a=new Promise(function(n,r){var o,a=function(e){n(e)},c=function(e){r(e)};o="string"==typeof e?{name:e}:e,t===undefined&&(t={});var u=t.target;u===undefined&&(u="best"),"string"==typeof u&&"all"!==u&&"best"!==u&&r({message:'"'+u+'" is not a valid target. Valid targets are "all", "best", or an instance.'}),t.methodResponseTimeout===undefined&&(t.methodResponseTimeout=t.method_response_timeout,t.methodResponseTimeout===undefined&&(t.methodResponseTimeout=i.configuration.methodResponseTimeout)),t.waitTimeoutMs===undefined&&(t.waitTimeoutMs=t.wait_for_method_timeout,t.waitTimeoutMs===undefined&&(t.waitTimeoutMs=i.configuration.waitTimeoutMs));var d=0,l=i.getServerMethodsByFilterAndTarget(o,u);if(l.length>0)s(l,l[0].methods[0],a,c);else{var f=function(){if(d+=500,l=i.getServerMethodsByFilterAndTarget(o,u),l.length>0){var n=l[0].methods[0];s(l,n,a,c)}else if(d>=t.waitTimeoutMs){var r="string"==typeof e?{name:e}:e,p={id:undefined,info:r,getInfoForUser:function(){return o},protocolState:undefined};s(l,p,a,c)}else setTimeout(f,500)};setTimeout(f,500)}});return o["default"](a,n,r)},Client.prototype.servers=function(e){return this.getServers(e).map(function(e){return e.server.getInfoForUser()})},Client.prototype.methods=function(e){return this.getMethods(e).map(function(e){return e.getInfoForUser()})},Client.prototype.methodsForInstance=function(e){return this.getMethodsForInstance(e).map(function(e){return e.getInfoForUser()})},Client.prototype.methodAdded=function(e){return this.repo.onMethodAdded(function(t){e(t.getInfoForUser())})},Client.prototype.methodRemoved=function(e){return this.repo.onMethodRemoved(function(t){e(t.getInfoForUser())})},Client.prototype.serverAdded=function(e){return this.repo.onServerAdded(function(t){e(t.getInfoForUser())})},Client.prototype.serverRemoved=function(e){return this.repo.onServerRemoved(function(t,n){e(t.getInfoForUser(),n)})},Client.prototype.serverMethodAdded=function(e){return this.repo.onServerMethodAdded(function(t,n){e({server:t.getInfoForUser(),method:n.getInfoForUser()})})},Client.prototype.serverMethodRemoved=function(e){return this.repo.onServerMethodRemoved(function(t,n){e({server:t.getInfoForUser(),method:n.getInfoForUser()})})},Client.prototype.invoke=function(e,t,n,r,i,s){var a=this,c=new Promise(function(o,i){var s=function(e){o(e)},c=function(e){i(e)};if(t||(t={}),n||(n="best"),"string"==typeof n&&"all"!==n&&"best"!==n&&i({message:'"'+n+'" is not a valid target. Valid targets are "all" and "best".'}),r||(r={}),r.methodResponseTimeoutMs===undefined&&(r.methodResponseTimeoutMs=r.method_response_timeout,r.methodResponseTimeoutMs===undefined&&(r.methodResponseTimeoutMs=a.configuration.methodResponseTimeout)),r.waitTimeoutMs===undefined&&(r.waitTimeoutMs=r.wait_for_method_timeout,r.waitTimeoutMs===undefined&&(r.waitTimeoutMs=a.configuration.waitTimeoutMs)),r.waitTimeoutMs!==undefined&&"number"!=typeof r.waitTimeoutMs)return void i({message:'"'+r.waitTimeoutMs+"\" is not a valid number for 'waitTimeoutMs'"});if("object"!=typeof t)return void i({message:"The method arguments must be an object."});"string"==typeof e&&(e={name:e});var u=a.getServerMethodsByFilterAndTarget(e,n);if(0===u.length)a.invokeUnExisting(e,t,n,r,s,c);else if(1===u.length){var d=u[0];a.clientInvocations.invoke(d.methods[0],t,d.server,r,s,c)}else a.invokeOnAll(u,t,r,s,c)});return o["default"](c,i,s)},Client.prototype.invokeUnExisting=function(e,t,n,r,o,i){var s=this,a=function(){i({method:e,called_with:t,message:"Can not find a method matching "+JSON.stringify(e)+" with server filter "+JSON.stringify(n),executed_by:undefined,returned:undefined,status:undefined})};if(0===r.waitTimeoutMs)a();else{var c=0,u=function(){c+=500,s.getServerMethodsByFilterAndTarget(e,n).length>0?s.invoke(e,t,n,r,o,i):c>=r.waitTimeoutMs?a():setTimeout(u,500)};setTimeout(u,500)}},Client.prototype.invokeOnAll=function(e,t,n,r,o){var i=this,s=[],a=[],c=function(e){s.push(e),d()},u=function(e){a.push(e),d()},d=function(){if(!(s.length+a.length<e.length))if(0!==s.length){var t=s.reduce(function(e,t){return e.method=t.method,e.called_with=t.called_with,e.returned=t.returned,e.all_return_values.push({executed_by:t.executed_by,returned:t.returned,called_with:t.called_with,method:t.method,message:undefined,status:undefined}),e.executed_by=t.executed_by,e},{all_return_values:[]});0!==a.length&&(t.all_errors=[],a.forEach(function(e){t.all_errors.push({name:e.method.name,message:e.message})})),r(t)}else 0!==a.length&&o(a.reduce(function(e,t){return e.method=t.method,e.called_with=t.called_with,e.message=t.message,e.all_errors.push({executed_by:t.executed_by,message:t.message}),e},{all_errors:[]}))};e.forEach(function(e){i.clientInvocations.invoke(e.methods[0],t,e.server,n,c,u)})},Client.prototype.filterByTarget=function(e,t){var n=this,r=[];if("string"==typeof e){if("all"===e)r=t;else if("best"===e){var o=t.filter(function(e){return e.server.info.machine===n.instance.machine})[0];if(o)return[o];r=t[0]!==undefined?[t[0]]:[]}}else Array.isArray(e)||(e=[e]),Array.isArray(e)&&(r=e.reduce(function(e,r){var o=t.filter(function(e){return n.instanceMatch(r,e.server.info)});return e.concat(o)},[]));return r},Client.prototype.instanceMatch=function(e,t){return this.containsProps(e,t)},Client.prototype.methodMatch=function(e,t){return this.containsProps(e,t)},Client.prototype.containsProps=function(e,t){return Object.keys(e).reduce(function(n,r){return e[r]&&"function"!=typeof e[r]?e[r].constructor===RegExp?!!e[r].test(t[r])&&n:String(e[r]).toLowerCase()===String(t[r]).toLowerCase()&&n:n},!0)},Client.prototype.getMethods=function(e){var t=this;return e===undefined?this.repo.getMethods():("string"==typeof e&&(e={name:e}),this.repo.getMethods().filter(function(n){return t.methodMatch(e,n.info)}))},Client.prototype.getMethodsForInstance=function(e){var t=this,n=this.repo.getServers(),r=n.filter(function(n){return t.instanceMatch(e,n.info)});if(0===r.length)return[];var o={};return 1===r.length?o=r[0].methods:r.forEach(function(e){Object.keys(e.methods).forEach(function(t){var n=e.methods[t];o[n.id]=n})}),Object.keys(o).map(function(e){return o[e]})},Client.prototype.getServers=function(e){var t=this,n=this.repo.getServers();return e===undefined?n.map(function(e){return{server:e}}):this.getMethods(e)===undefined?[]:n.reduce(function(n,r){var o=t.repo.getServerMethodsById(r.id),i=o.filter(function(n){return t.methodMatch(e,n.info)});return i.length>0&&n.push({server:r,methods:i}),n},[])},Client.prototype.getServerMethodsByFilterAndTarget=function(e,t){var n=this.getServers(e);return this.filterByTarget(t,n)},Client}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),o=function(){function ClientInvocations(e){var t=this;this._protocol=e,this._pendingCallbacks={},e.client.onInvocationResult(function(e,n,r,o,i){return t.processInvocationResult(e,n,r,o,i)})}return ClientInvocations.prototype.invoke=function(e,t,n,o,i,s){var a=r["default"]();this.registerInvocation(a,{method:e,calledWith:t},i,s,o.methodResponseTimeoutMs),this._protocol.client.invoke(a,e,t,n,o)},ClientInvocations.prototype.registerInvocation=function(e,t,n,r,o){var i=this;this._pendingCallbacks[e]={invocationInfo:t,success:n,error:r},setTimeout(function(){i._pendingCallbacks[e]!==undefined&&(r({method:t.method.getInfoForUser(),called_with:t.calledWith,executed_by:undefined,status:undefined,returned:undefined,message:"Invocation timeout ("+o+" ms) reached"}),delete i._pendingCallbacks[e])},o)},ClientInvocations.prototype.processInvocationResult=function(e,t,n,r,o){var i=this._pendingCallbacks[e];i!==undefined&&(0===n&&"function"==typeof i.success?i.success({method:i.invocationInfo.method.getInfoForUser(),called_with:i.invocationInfo.calledWith,executed_by:t,returned:r,message:o,status:n}):"function"==typeof i.error&&i.error({method:i.invocationInfo.method.getInfoForUser(),called_with:i.invocationInfo.calledWith,executed_by:t,message:o,status:n,returned:r}),delete this._pendingCallbacks[e])},ClientInvocations}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function ClientRepository(){this.servers={},this.methodsCount={},this.callbacks=r["default"]()}return ClientRepository.prototype.addServer=function(e,t){var n=this,r=this.servers[t];if(r)return r.id;var o={id:t,info:e,methods:{},getInfoForUser:function(){var e=n.createUserServerInfo(o.info);return e.getMethods=function(){return n.getServerMethodsById(o.id).map(function(e){return e.getInfoForUser()})},e.getStreams=function(){return n.getServerMethodsById(o.id).filter(function(e){return e.info.supportsStreaming}).map(function(e){return e.getInfoForUser()})},e}};return this.servers[t]=o,this.callbacks.execute("onServerAdded",o),t},ClientRepository.prototype.removeServerById=function(e,t){var n=this,r=this.servers[e];Object.keys(r.methods).forEach(function(t){n.removeServerMethod(e,t)}),delete this.servers[e],this.callbacks.execute("onServerRemoved",r,t)},ClientRepository.prototype.addServerMethod=function(e,t,n){n||(n={});var r=this.servers[e];if(!r)throw new Error("server does not exists");var o=this.createMethodId(t);if(!r.methods[o]){var i=this,s={id:o,info:t,getInfoForUser:function(){var e=i.createUserMethodInfo(s.info);return e.getServers=function(){return i.getServersByMethod(o)},e},protocolState:n};r.methods[o]=s,this.methodsCount[o]||(this.methodsCount[o]=0,this.callbacks.execute("onMethodAdded",s)),this.methodsCount[o]=this.methodsCount[o]+1,this.callbacks.execute("onServerMethodAdded",r,s)}},ClientRepository.prototype.createMethodId=function(e){var t=e.accepts!==undefined?e.accepts:"",n=e.returns!==undefined?e.returns:"";return(e.name+t+n).toLowerCase()},ClientRepository.prototype.removeServerMethod=function(e,t){var n=this.servers[e];if(!n)throw new Error("server does not exists");var r=n.methods[t];delete n.methods[t],this.methodsCount[t]=this.methodsCount[t]-1,0===this.methodsCount[t]&&this.callbacks.execute("onMethodRemoved",r),this.callbacks.execute("onServerMethodRemoved",n,r)},ClientRepository.prototype.getMethods=function(){var e=this,t={};return Object.keys(this.servers).forEach(function(n){var r=e.servers[n];Object.keys(r.methods).forEach(function(e){var n=r.methods[e];t[n.id]=n})}),Object.keys(t).map(function(e){return t[e]})},ClientRepository.prototype.getServers=function(){var e=this,t=[];return Object.keys(this.servers).forEach(function(n){var r=e.servers[n];t.push(r)}),t},ClientRepository.prototype.getServerMethodsById=function(e){var t=this.servers[e];return Object.keys(t.methods).map(function(e){return t.methods[e]})},ClientRepository.prototype.onServerAdded=function(e){var t=this.callbacks.add("onServerAdded",e);return this.getServers().forEach(function(t){e(t)}),t},ClientRepository.prototype.onMethodAdded=function(e){var t=this.callbacks.add("onMethodAdded",e);return this.getMethods().forEach(function(t){e(t)}),t},ClientRepository.prototype.onServerMethodAdded=function(e){var t=this.callbacks.add("onServerMethodAdded",e);return this.getServers().forEach(function(t){var n=t.methods;Object.keys(n).forEach(function(r){e(t,n[r])})}),t},ClientRepository.prototype.onMethodRemoved=function(e){return this.callbacks.add("onMethodRemoved",e)},ClientRepository.prototype.onServerRemoved=function(e){return this.callbacks.add("onServerRemoved",e)},ClientRepository.prototype.onServerMethodRemoved=function(e){return this.callbacks.add("onServerMethodRemoved",e)},ClientRepository.prototype.getServerById=function(e){return this.servers[e]},ClientRepository.prototype.reset=function(){this.servers={},this.methodsCount={}},ClientRepository.prototype.createUserServerInfo=function(e){return{machine:e.machine,pid:e.pid,user:e.user,application:e.application,environment:e.environment,region:e.region,instance:e.instance,windowId:e.windowId,peerId:e.peerId}},ClientRepository.prototype.createUserMethodInfo=function(e){var t={name:e.name,accepts:e.accepts,returns:e.returns,description:e.description,displayName:e.displayName,objectTypes:e.objectTypes,supportsStreaming:e.supportsStreaming};return t.object_types=e.objectTypes,t.display_name=e.objectTypes,t.version=e.objectTypes,t},ClientRepository.prototype.getServersByMethod=function(e){var t=this,n=[];return Object.keys(this.servers).forEach(function(r){var o=t.servers[r];Object.keys(o.methods).forEach(function(t){t===e&&n.push(o.getInfoForUser())})}),n},ClientRepository}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=function(){function NativeAGM(e,t,n){this.instance=e,this.helpers=t,this.agmFacade=n,this.protocolVersion=this.agmFacade.protocolVersion}return NativeAGM.prototype.register=function(e,t){var n=this.helpers.stringToObject(e,"name");this.helpers.validateMethodInfo(n),this.protocolVersion&&this.protocolVersion>=3?this.agmFacade.register(JSON.stringify(n),t,!0):this.agmFacade.register(JSON.stringify(n),function(e,n){var r=t(JSON.parse(e),n);return JSON.stringify(r)})},NativeAGM.prototype.registerAsync=function(e,t){if(!this.agmFacade.registerAsync)throw new Error("not supported in that version of HtmlContainer");var n=this.helpers.stringToObject(e,"name");this.helpers.validateMethodInfo(n),this.agmFacade.registerAsync(n,function(e,n,r){t(e,n,function(e){r.success(e)},function(e){r.error(e)})})},NativeAGM.prototype.unregister=function(e){this.agmFacade.unregister(JSON.stringify(this.helpers.stringToObject(e,"name")))},NativeAGM.prototype.invoke=function(e,t,n,o,i,s){var a=this,c=new Promise(function(r,i){if(t===undefined&&(t={}),"object"!=typeof t&&i({message:"The method arguments must be an object."}),o===undefined&&(o={}),n=a.helpers.targetArgToObject(n),a.agmFacade.invoke2)a.agmFacade.invoke2(JSON.stringify(a.helpers.stringToObject(e,"name")),t,JSON.stringify(n),JSON.stringify(o),function(e){r(e)},function(e){i(e)});else{var s=void 0,c=void 0;s=function(e){var t=JSON.parse(e);r(t)},c=function(e){var t=JSON.parse(e);i(t)},a.agmFacade.invoke(JSON.stringify(a.helpers.stringToObject(e,"name")),JSON.stringify(t),JSON.stringify(n),JSON.stringify(o),s,c)}});return r["default"](c,i,s)},NativeAGM.prototype.createStream=function(e,t,n,o){var i=this,s=new Promise(function(n,r){"string"==typeof e&&(e={name:e,getServers:function(){return[]}}),t||(t={subscriptionRequestHandler:undefined,subscriptionAddedHandler:undefined,subscriptionRemovedHandler:undefined}),i.agmFacade.createStream2(JSON.stringify(e),t.subscriptionRequestHandler,t.subscriptionAddedHandler,t.subscriptionRemovedHandler,function(e){n(e)},function(e){r(e)})});return r["default"](s,n,o)},NativeAGM.prototype.subscribe=function(e,t,n,o){var i=this,s=new Promise(function(n,r){void 0===e&&r("method definition param is required"),t===undefined&&(t={}),t.args=JSON.stringify(t.arguments||{}),t.target=i.helpers.targetArgToObject(t.target);var o;o="string"==typeof e?e:e.name,i.agmFacade.subscribe2(o,JSON.stringify(t),function(e){n(e)},function(e){r(e)})});return r["default"](s,n,o)},NativeAGM.prototype.servers=function(e){var t=this,n=this.agmFacade.servers(JSON.stringify(this.helpers.stringToObject(e,"name")));return this.helpers.agmParse(n).map(function(e){return t.transformServerObject(e)})},NativeAGM.prototype.methods=function(e){var t=this,n=this.agmFacade.methods(JSON.stringify(this.helpers.stringToObject(e,"name")));return this.helpers.agmParse(n).map(function(e){return t.transformMethodObject(e)})},NativeAGM.prototype.methodAdded=function(e){var t=this,n=!0;return this.agmFacade.methodAdded(function(r){n&&e(t.transformMethodObject(r))}),function(){n=!1}},NativeAGM.prototype.methodRemoved=function(e){var t=this,n=!0;return this.agmFacade.methodRemoved(function(r){n&&e(t.transformMethodObject(r))}),function(){n=!1}},NativeAGM.prototype.serverAdded=function(e){var t=this,n=!0;return this.agmFacade.serverAdded(function(r){n&&e(t.transformServerObject(r))}),function(){n=!1}},NativeAGM.prototype.serverRemoved=function(e){var t=this,n=!0;return this.agmFacade.serverRemoved(function(r){n&&e(t.transformServerObject(r))}),function(){n=!1}},NativeAGM.prototype.serverMethodAdded=function(e){var t=this,n=!0;return this.agmFacade.serverMethodAdded(function(r){n&&e({server:t.transformServerObject(r.server),method:t.transformMethodObject(r.method)})}),function(){n=!1}},NativeAGM.prototype.serverMethodRemoved=function(e){var t=this,n=!0;return this.agmFacade.serverMethodRemoved(function(r){n&&e({server:t.transformServerObject(r.server),method:t.transformMethodObject(r.method)})}),function(){n=!1}},NativeAGM.prototype.methodsForInstance=function(e){var t=this.agmFacade.methodsForInstance(JSON.stringify(e));return this.helpers.agmParse(t).map(this.transformMethodObject)},NativeAGM.prototype.transformMethodObject=function(e){var t=this;return e?(e.displayName||(e.displayName=e.display_name),e.objectTypes||(e.objectTypes=e.object_types),e.getServers=function(){return t.servers(e.name)},e):undefined},NativeAGM.prototype.transformServerObject=function(e){var t=this;return e?(e.getMethods=function(){return t.methodsForInstance(e)},e.getStreams=function(){return t.methodsForInstance(e).filter(function(e){return e.supportsStreaming})},e):undefined},NativeAGM}();t.NativeAGM=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function Helpers(e){this.facade=e,this.dateTimeIdentifier=e.jsonValueDatePrefix,this.lenOfIdentifier=this.dateTimeIdentifier.length}return Helpers.prototype.agmParse=function(e){var t=this;return JSON.parse(e,function(e,n){if("string"!=typeof n)return n;if(n[0]!==t.dateTimeIdentifier[0])return n;if(0!==n.indexOf(t.dateTimeIdentifier))return n;var r=n.substr(t.lenOfIdentifier);return new Date(parseFloat(r))})},Helpers.prototype.targetArgToObject=function(e){var t=this;if("string"==typeof(e=e||"best")){if("all"!==e&&"best"!==e)throw new Error(e+" is not a valid target. Valid targets are 'all' and 'best'");return{target:e}}return Array.isArray(e)||(e=[e]),e=e.map(function(e){return t.convertInstanceToRegex(e)}),{serverFilter:e}},Helpers.prototype.convertInstanceToRegex=function(e){var t={};return Object.keys(e).forEach(function(n){var r=e[n];t[n]=r,void 0!==r&&null!==r&&("string"==typeof r&&""!==r?t[n]="^"+e[n]+"$":e[n].constructor===RegExp?t[n]=e[n].source:t[n]=e[n])}),t},Helpers.prototype.validateMethodInfo=function(e){if(void 0===e)throw Error("methodInfo is required argument");if(!e.name)throw Error("methodInfo object must contain name property");e.objectTypes&&(e.object_types=e.objectTypes),e.displayName&&(e.display_name=e.displayName)},Helpers.prototype.stringToObject=function(e,t){if("string"==typeof e){var n={};return n[t]=e,n}return e},Helpers}();t.Helpers=r},function(e,t,n){"use strict";function default_1(e){var t=window.htmlContainer.jsAgmFacade,n=i(e);return new Promise(function(e,i){var s=function(n){var i=new r.NativeAGM(n,new o.Helpers(t),t);i.create_stream=i.createStream,i.methods_for_instance=i.methodsForInstance,i.method_added=i.methodAdded,i.method_removed=i.methodRemoved,i.server_added=i.serverAdded,i.server_removed=i.serverRemoved,i.server_method_added=i.serverMethodAdded,i.server_method_removed=i.serverMethodRemoved,e(i)};if(t.protocolVersion&&t.protocolVersion>=5&&t.initAsync)t.initAsync(n,s,function(e){i(e)});else{s(t.init(n))}})}Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),o=n(31);t["default"]=default_1;var i=function(e){if(e!==undefined&&e.metrics!==undefined){e.metrics.metricsIdentity=e.metrics.identity;var t={metricsIdentity:e.metrics.metricsIdentity,path:e.metrics.path};e.metrics=t}return delete e.logger,JSON.stringify(e)}},function(e,t,n){"use strict";(function(e){function createOwnInstance(t,n,o){var i=e.document||e.process,s={application:i.title+r["default"](),pid:Math.floor(1e10*Math.random())};return s.peerId=o,"object"==typeof t&&(t.application!==undefined&&(s.application=t.application),s.machine=t.machine,s.user=t.user,s.environment=t.environment,s.region=t.region),void 0!==n&&(s.user=n.user,s.instance=n.instance,s.application=n.application,s.pid=n.process,s.machine=n.machine,s.environment=n.environment,s.region=n.region,s.windowId=n.windowId),s}Object.defineProperty(t,"__esModule",{value:!0});var r=n(11);t.createOwnInstance=createOwnInstance}).call(t,n(5))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(33),o=n(32),i=n(37),s=n(26),a=n(29),c=n(41);t["default"]=function(e){if(!e.forceGW&&2===e.gdVersion)return o["default"](e);if(void 0===e)throw new Error("configuration is required");if("undefined"==typeof e.connection)throw new Error("configuration.connections is required");var t=e.connection;"number"!=typeof e.methodResponseTimeout&&(e.methodResponseTimeout=3e3),"number"!=typeof e.waitTimeoutMs&&(e.waitTimeoutMs=3e3);var n,u,d=t.resolvedIdentity,l=r.createOwnInstance(e.instance,d,t.peerId),f=new a["default"],p=new c["default"];if(3!==t.protocolVersion)throw new Error("agm protocol version "+t.protocolVersion+" not supported");return n=i["default"](l,t,f,p,e,function(){return u}),new Promise(function(t,r){n.then(function(n){u=new s["default"](n,f,p,l,e),t(u)})["catch"](function(e){r(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="awaitingAccept",o="subscribed",i="Subscription rejected.",s=function(){function ClientStreaming(e,t,n,s){var a=this;this.instance=e,this.session=t,this.repository=n,this.logger=s,this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(e){var t=e._tag,n=t.subLocalKey,s=a.subscriptionsList[n];if("object"==typeof s&&(s.trackedServers=s.trackedServers.filter(function(e){return e.serverId!==t.serverId}),s.trackedServers.length<=0)){if(clearTimeout(s.timeoutId),s.status===r){var c="string"==typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",u="object"==typeof s.arguments?JSON.stringify(s.arguments):"{}";s.error({message:i+c+" Called with:"+u,called_with:s.arguments,method:s.method.getInfoForUser()})}else s.status===o&&a.callOnClosedHandlers(s);delete a.subscriptionsList[n]}},this.handleSubscribed=function(e){var t=e._tag.subLocalKey,n=a.subscriptionsList[t];if("object"==typeof n){var i=e._tag.serverId,s=n.trackedServers.filter(function(e){return e.serverId===i})[0];if("object"==typeof s){s.subscriptionId=e.subscription_id,a.subscriptionIdToLocalKeyMap[e.subscription_id]=t;var c=n.status===r;n.status=o;var u=a;c&&n.success({onData:function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");n.handlers.onData.push(e),1===n.handlers.onData.length&&n.queued.data.length>0&&n.queued.data.forEach(function(t){e(t)})},onClosed:function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");n.handlers.onClosed.push(e)},onFailed:function(){},close:function(){return u.closeSubscription(t)},requestArguments:n.arguments,serverInstance:u.repository.getServerById(i).getInfoForUser(),stream:n.method.info})}}},this.handleEventData=function(e){var t=a.subscriptionIdToLocalKeyMap[e.subscription_id];if(void 0!==t){var n=a.subscriptionsList[t];if("object"==typeof n){var r=n.trackedServers.filter(function(t){return t.subscriptionId===e.subscription_id});if(1===r.length){var o=e.oob&&e.snapshot,i=r[0].serverId,s=function(){return{data:e.data,server:a.repository.getServerById(i).getInfoForUser(),requestArguments:n.arguments||{},message:null,private:o}},c=n.handlers.onData,u=n.queued.data;c.length>0?c.forEach(function(e){"function"==typeof e&&e(s())}):u.push(s())}}}},this.handleSubscriptionCancelled=function(e){var t=a.subscriptionIdToLocalKeyMap[e.subscription_id];if(void 0!==t){var n=a.subscriptionsList[t];if("object"==typeof n){var r=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter(function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)}),n.trackedServers.length===r&&(n.trackedServers.length<=0&&(clearTimeout(n.timeoutId),a.callOnClosedHandlers(n),delete a.subscriptionsList[t]),delete a.subscriptionIdToLocalKeyMap[e.subscription_id])}}},t.on("subscribed",this.handleSubscribed),t.on("event",this.handleEventData),t.on("subscription-cancelled",this.handleSubscriptionCancelled)}return ClientStreaming.prototype.subscribe=function(e,t,n,r,o,i){var s=this;if(0===n.length)return void i({method:e.getInfoForUser(),called_with:t,message:"Subscription failed. No available servers matched the target params."});var a=this.getNextSubscriptionLocalKey(),c=this.registerSubscription(a,e,t,o,i,r.methodResponseTimeout);if("object"!=typeof c)return void i({method:e.getInfoForUser(),called_with:t,message:"Subscription failed. Unable to register the user callbacks."});n.forEach(function(n){var r=n.server.id;c.trackedServers.push({serverId:r,subscriptionId:undefined});var o={type:"subscribe",server_id:r,method_id:e.protocolState.id,arguments_kv:t};s.session.send(o,{serverId:r,subLocalKey:a}).then(function(e){return s.handleSubscribed(e)})["catch"](function(e){return s.handleErrorSubscribing(e)})})},ClientStreaming.prototype.getNextSubscriptionLocalKey=function(){var e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e},ClientStreaming.prototype.registerSubscription=function(e,t,n,i,s,a){var c=this;return this.subscriptionsList[e]={status:r,method:t,arguments:n,success:i,error:s,trackedServers:[],handlers:{onData:[],onClosed:[]},queued:{data:[],closers:[]},timeoutId:undefined},this.subscriptionsList[e].timeoutId=setTimeout(function(){if(c.subscriptionsList[e]!==undefined){var i=c.subscriptionsList[e];i.status===r?(s({method:t.getInfoForUser(),called_with:n,message:"Subscription failed. Subscription attempt timed out after "+a+" ms."}),delete c.subscriptionsList[e]):i.status===o&&i.trackedServers.length>0&&(i.trackedServers=i.trackedServers.filter(function(e){return"undefined"!=typeof e.subscriptionId}),delete i.timeoutId,i.trackedServers.length<=0&&(c.callOnClosedHandlers(i),delete c.subscriptionsList[e]))}},a),this.subscriptionsList[e]},ClientStreaming.prototype.callOnClosedHandlers=function(e,t){var n=e.queued.closers.length,r=n>0?e.queued.closers[n-1]:null,o=null;"number"==typeof r&&(o=this.repository.getServerById(r).getInfoForUser()),e.handlers.onClosed.forEach(function(n){"function"==typeof n&&n({message:t||"ServerInitiated",requestArguments:e.arguments,server:o,stream:e.method})})},ClientStreaming.prototype.closeSubscription=function(e){var t=this,n=this.subscriptionsList[e];"object"==typeof n&&(n.trackedServers.forEach(function(e){"undefined"!=typeof e.subscriptionId&&(t.session.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:"ClientInitiated"}),delete t.subscriptionIdToLocalKeyMap[e.subscriptionId])}),n.trackedServers=[],this.callOnClosedHandlers(n,"ClientInitiated"),delete this.subscriptionsList[e])},ClientStreaming}();t["default"]=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(35),i=function(){function ClientProtocol(e,t,n,i){var s=this;this.instance=e,this.session=t,this.repository=n,this.logger=i,this.callbacks=r["default"](),t.on("peer-added",function(e){return s.handlePeerAdded(e)}),t.on("peer-removed",function(e){return s.handlePeerRemoved(e)}),t.on("methods-added",function(e){return s.handleMethodsAddedMessage(e)}),t.on("methods-removed",function(e){return s.handleMethodsRemovedMessage(e)}),this.streaming=new o["default"](e,t,n,i)}return ClientProtocol.prototype.subscribe=function(e,t,n,r,o,i){this.streaming.subscribe(e,t,n,r,o,i)},ClientProtocol.prototype.invoke=function(e,t,n,r){var o=this,i=r.id,s=t.protocolState.id,a={type:"call",server_id:i,method_id:s,arguments_kv:n};this.session.send(a,{invocationId:e,serverId:i}).then(function(e){return o.handleResultMessage(e)})["catch"](function(e){return o.handleInvocationError(e)})},ClientProtocol.prototype.onInvocationResult=function(e){this.callbacks.add("onResult",e)},ClientProtocol.prototype.handlePeerAdded=function(e){var t=e.new_peer_id,n=e.identity,r=Number(n.process),o={machine:n.machine,pid:isNaN(r)?n.process:r,instance:n.instance,application:n.application,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t};this.repository.addServer(o,t)},ClientProtocol.prototype.handlePeerRemoved=function(e){var t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)},ClientProtocol.prototype.handleMethodsAddedMessage=function(e){var t=this,n=e.server_id;e.methods.forEach(function(e){var r={name:e.name,displayName:e.display_name,description:e.description,version:e.version,objectTypes:e.object_types,accepts:e.input_signature,returns:e.result_signature,supportsStreaming:"undefined"!=typeof e.flags&&e.flags.streaming};t.repository.addServerMethod(n,r,{id:e.id})})},ClientProtocol.prototype.handleMethodsRemovedMessage=function(e){var t=this,n=e.server_id,r=e.methods,o=this.repository.getServerById(n);Object.keys(o.methods).forEach(function(e){var i=o.methods[e];r.indexOf(i.protocolState.id)>-1&&t.repository.removeServerMethod(n,e)})},ClientProtocol.prototype.handleResultMessage=function(e){var t=e._tag.invocationId,n=e.result,r=e._tag.serverId,o=this.repository.getServerById(r);this.callbacks.execute("onResult",t,o.getInfoForUser(),0,n,"")},ClientProtocol.prototype.handleInvocationError=function(e){this.logger.debug("handle invocation error "+JSON.stringify(e));var t=e._tag.invocationId,n=e._tag.serverId,r=this.repository.getServerById(n),o=e.reason,i=e.context;this.callbacks.execute("onResult",t,r.getInfoForUser(),1,i,o)},ClientProtocol}();t["default"]=i},function(e,t,n){"use strict";function default_1(e,t,n,i,s,a){function handleReconnect(){u.info("reconnected - will replay registered methods and subscriptions"),n.reset(),n.addServer(e,t.peerId);var r=i.getList();i.reset(),r.forEach(function(e){var t=e.definition;e.theFunction.userCallback?a().register(t,e.theFunction.userCallback):e.theFunction.userCallbackAsync&&a().registerAsync(t,e.theFunction.userCallbackAsync)})}function handleInitialJoin(){n.addServer(e,t.peerId),c({client:p,server:f}),c=undefined}var c,u=s.logger.subLogger("gw3-protocol"),d=new Promise(function(e){c=e}),l=t.domain("agm",u.subLogger("domain"),["subscribed"]),f=new r["default"](e,l,n,i,u.subLogger("server")),p=new o["default"](e,l,n,u.subLogger("client"));return l.onJoined(function(e){e?handleReconnect():handleInitialJoin()}),l.join(),d}Object.defineProperty(t,"__esModule",{value:!0});var r=n(39),o=n(36);t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function ServerStreaming(e,t,n,o,i){var s=this;this.instance=e,this.session=t,this.repository=n,this.serverRepository=o,this.logger=i,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=r["default"](),this.nextStreamId=0,t.on("add-interest",function(e){s.handleAddInterest(e)}),t.on("remove-interest",function(e){s.handleRemoveInterest(e)})}return ServerStreaming.prototype.acceptRequestOnBranch=function(e,t,n){if("string"!=typeof n&&(n=""),"object"!=typeof t.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(t,n),o=e.msg.subscription_id,i={id:o,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:r,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[o]=i,this.session.sendFireAndForget({type:"accepted",subscription_id:o,stream_id:r}),this.callbacks.execute("onSubscriptionAdded",i,t)},ServerStreaming.prototype.rejectRequest=function(e,t,n){"string"!=typeof n&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)},ServerStreaming.prototype.pushData=function(e,t,n){var r=this;if("object"==typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=null);e.protocolState.branchKeyToStreamIdMap.filter(function(e){return null===n||Boolean(e)&&"string"==typeof e.key&&n.indexOf(e.key)>=0}).map(function(e){return e.streamId}).forEach(function(e){var n={type:"publish",stream_id:e,data:t};r.session.sendFireAndForget(n)})}},ServerStreaming.prototype.pushDataToSingle=function(e,t,n){if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(r)},ServerStreaming.prototype.closeSingleSubscription=function(e,t){delete e.protocolState.subscriptionsMap[t.id];var n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n);t.instance;this.callbacks.execute("onSubscriptionRemoved",t,e)},ServerStreaming.prototype.closeMultipleSubscriptions=function(e,t){var n=this;if("object"==typeof e&&"object"==typeof e.protocolState.subscriptionsMap){var r=Object.keys(e.protocolState.subscriptionsMap).map(function(t){return e.protocolState.subscriptionsMap[t]});"string"==typeof t&&(r=r.filter(function(e){return e.branchKey===t})),r.forEach(function(t){delete e.protocolState.subscriptionsMap[t.id];var r={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping all subscriptions on stream_id: "+t.streamId};n.session.sendFireAndForget(r)})}},ServerStreaming.prototype.getSubscriptionList=function(e,t){if("object"!=typeof e)return[];var n=Object.keys(e.protocolState.subscriptionsMap).map(function(t){return e.protocolState.subscriptionsMap[t]});return"string"!=typeof t?n:n.filter(function(e){return e.branchKey===t})},ServerStreaming.prototype.getBranchList=function(e){if("object"!=typeof e)return[];var t=Object.keys(e.protocolState.subscriptionsMap).map(function(t){return e.protocolState.subscriptionsMap[t]}),n=t.map(function(e){var t=null;return"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),t}),r=[];return n.filter(function(e){return!(null===e||r.indexOf(e)>=0)&&(r.push(e),!0)})},ServerStreaming.prototype.onSubAdded=function(e){this.onSubscriptionLifetimeEvent("onSubscriptionAdded",e)},ServerStreaming.prototype.onSubRequest=function(e){this.onSubscriptionLifetimeEvent("onSubscriptionRequest",e)},ServerStreaming.prototype.onSubRemoved=function(e){this.onSubscriptionLifetimeEvent("onSubscriptionRemoved",e)},ServerStreaming.prototype.handleRemoveInterest=function(e){var t=this.serverRepository.getById(e.method_id);if("string"==typeof e.subscription_id&&"object"==typeof t&&"object"==typeof t.protocolState.subscriptionsMap[e.subscription_id]){var n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute("onSubscriptionRemoved",n,t)}},ServerStreaming.prototype.onSubscriptionLifetimeEvent=function(e,t){this.callbacks.add(e,t)},ServerStreaming.prototype.getNextStreamId=function(){return this.nextStreamId+++""},ServerStreaming.prototype.handleAddInterest=function(e){var t=this.repository.getServerById(e.caller_id),n="function"==typeof t.getInfoForUser?t.getInfoForUser():null,r={msg:e,arguments:e.arguments_kv||{},instance:n},o=this.serverRepository.getById(e.method_id);if(o===undefined){var i="No method with id "+e.method_id+" on this server.";return void this.sendSubscriptionFailed(i,e.subscription_id)}if(o.protocolState.subscriptionsMap&&o.protocolState.subscriptionsMap[e.subscription_id])return void this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id);this.callbacks.execute("onSubscriptionRequest",r,o)},ServerStreaming.prototype.sendSubscriptionFailed=function(e,t){var n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)},ServerStreaming.prototype.getStreamId=function(e,t){"string"!=typeof t&&(t="");var n=e.protocolState.branchKeyToStreamIdMap.filter(function(e){return e.key===t})[0],r=n?n.streamId:undefined;return"string"==typeof r&&""!==r||(r=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:r})),r},ServerStreaming}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(38),i=function(){function ServerProtocol(e,t,n,i,s){var a=this;this.session=t,this.clientRepository=n,this.serverRepository=i,this.logger=s,this.callbacks=r["default"](),this.streaming=new o["default"](e,t,n,i,s),this.session.on("invoke",function(e){return a.handleInvokeMessage(e)})}return ServerProtocol.prototype.createStream=function(e,t,n){e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,t,n,!0)},ServerProtocol.prototype.register=function(e,t,n,r){var o=this,i=e.definition;e.protocolState.registrationCallbacks={success:t,fail:n};var s={streaming:r||!1};this.logger.debug('registering method "'+i.name+'"');var a={type:"register",methods:[{id:e.repoId,name:i.name,display_name:i.displayName,description:i.description,version:i.version,flags:s,object_types:i.objectTypes||i.object_types,input_signature:i.accepts,result_signature:i.returns,restrictions:undefined}]};this.session.send(a,{methodId:e.repoId}).then(function(e){return o.handleRegisteredMessage(e)})["catch"](function(e){return o.handleErrorRegister(e)})},ServerProtocol.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},ServerProtocol.prototype.methodInvocationResult=function(e,t,n,r){var o;o=n?{type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:r,peer_id:undefined}:{type:"yield",invocation_id:t,peer_id:this.session.peerId,result:r,request_id:undefined},this.session.sendFireAndForget(o)},ServerProtocol.prototype.unregister=function(e){var t={type:"unregister",methods:[e.repoId]};this.session.send(t)},ServerProtocol.prototype.getBranchList=function(e){return this.streaming.getBranchList(e)},ServerProtocol.prototype.getSubscriptionList=function(e,t){return this.streaming.getSubscriptionList(e,t)},ServerProtocol.prototype.closeAllSubscriptions=function(e,t){this.streaming.closeMultipleSubscriptions(e,t)},ServerProtocol.prototype.pushData=function(e,t,n){this.streaming.pushData(e,t,n)},ServerProtocol.prototype.pushDataToSingle=function(e,t,n){this.streaming.pushDataToSingle(e,t,n)},ServerProtocol.prototype.closeSingleSubscription=function(e,t){this.streaming.closeSingleSubscription(e,t)},ServerProtocol.prototype.acceptRequestOnBranch=function(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)},ServerProtocol.prototype.rejectRequest=function(e,t,n){this.streaming.rejectRequest(e,t,n)},ServerProtocol.prototype.onSubRequest=function(e){this.streaming.onSubRequest(e)},ServerProtocol.prototype.onSubAdded=function(e){this.streaming.onSubAdded(e)},ServerProtocol.prototype.onSubRemoved=function(e){this.streaming.onSubRemoved(e)},ServerProtocol.prototype.handleRegisteredMessage=function(e){var t=e._tag.methodId,n=this.serverRepository.getById(t);n&&n.protocolState.registrationCallbacks&&(this.logger.debug("registered method "+n.definition.name+" with id "+t),n.protocolState.registrationCallbacks.success())},ServerProtocol.prototype.handleErrorRegister=function(e){this.logger.warn(JSON.stringify(e));var t=e._tag.methodId,n=this.serverRepository.getById(t);n&&n.protocolState.registrationCallbacks&&(this.logger.debug("failed to register method "+n.definition.name+" with id "+t),n.protocolState.registrationCallbacks.fail())},ServerProtocol.prototype.handleInvokeMessage=function(e){var t=e.invocation_id,n=e.caller_id,r=e.method_id,o=e.arguments_kv;this.logger.debug('received invocation for method id "'+r+'" from peer '+n);var i=this.serverRepository.getList(),s=i.filter(function(e){return e.repoId===r})[0];if(s!==undefined){var a=this.clientRepository.getServerById(n),c={args:o,instance:a.getInfoForUser()};this.callbacks.execute("onInvoked",s,t,c)}},ServerProtocol}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=function(){function ServerBranch(e,t,n){this.key=e,this.protocol=t,this.repoMethod=n}return ServerBranch.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map(function(t){return new r["default"](e.protocol,e.repoMethod,t)})},ServerBranch.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},ServerBranch.prototype.push=function(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])},ServerBranch}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function ServerRepository(){this.nextId=0,this.methods=[]}return ServerRepository.prototype.add=function(e){if("object"==typeof e&&e.repoId===undefined)return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e},ServerRepository.prototype.remove=function(e){if("string"!=typeof e)return new TypeError("Expecting a string");this.methods=this.methods.filter(function(t){return t.repoId!==e})},ServerRepository.prototype.getById=function(e){return"string"!=typeof e?undefined:this.methods.filter(function(t){return t.repoId===e})[0]},ServerRepository.prototype.getList=function(){return this.methods.map(function(e){return e})},ServerRepository.prototype.length=function(){return this.methods.length},ServerRepository.prototype.reset=function(){this.methods=[]},ServerRepository}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function Request(e,t,n){this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}return Request.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},Request.prototype.acceptOnBranch=function(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)},Request.prototype.reject=function(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)},Request}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(45),i=n(44),s=function(){function Server(e,t,n,r){this.protocol=e,this.serverRepository=t,this.instance=n,this.configuration=r,this.invocations=0,this.streaming=new o["default"](e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return Server.prototype.register=function(e,t){var n=function(e,n){try{var r=t(e.args,e.instance);n(null,r)}catch(e){n(e,e)}};n.userCallback=t,this.registerCore(e,n)},Server.prototype.registerAsync=function(e,t){var n=function(e,n){try{t(e.args,e.instance,function(e){n(null,e)},function(e){n(e,e)})}catch(e){n(e,null)}};n.userCallbackAsync=t,this.registerCore(e,n)},Server.prototype.createStream=function(e,t,n,o){var s=this,a=new Promise(function(n,r){"string"==typeof e&&(""===e&&r("Invalid stream name - can not be empty"),e={name:e}),e.supportsStreaming=!0,t||(t={}),"function"!=typeof t.subscriptionRequestHandler&&(t.subscriptionRequestHandler=function(e){e.accept()});var o={definition:e,streamCallbacks:t,protocolState:{}};s.serverRepository.add(o),s.protocol.server.createStream(o,function(){var e=new i["default"](s.protocol,o,s);o.stream=e,n(e)},function(e){s.serverRepository.remove(o.repoId),r(e)})});return r["default"](a,n,o)},Server.prototype.unregister=function(e){var t=this;"string"==typeof e&&(e={name:e}),this.serverRepository.getList().filter(function(n){return t.containsProps(e,n.definition)}).forEach(function(e){t.serverRepository.remove(e.repoId),t.protocol.server.unregister(e)})},Server.prototype.registerCore=function(e,t){var n=this;"string"==typeof e&&(e={name:e});var r=this.serverRepository.add({definition:e,theFunction:t,protocolState:{}});this.protocol.server.register(r,function(){},function(){n.serverRepository.remove(r.repoId)})},Server.prototype.containsProps=function(e,t){var n=!0;return Object.keys(e).forEach(function(r){e[r]!==t[r]&&(n=!1)}),n},Server.prototype.onMethodInvoked=function(e,t,n){var r=this;e&&e.theFunction(n,function(n,o){n&&("string"==typeof n.message?n=n.message:"string"!=typeof n&&(n="<>")),o&&"object"==typeof o&&o.constructor!==Array||(o={_result:o}),r.protocol.server.methodInvocationResult(e,t,n,o)})},Server}();t["default"]=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(40),i=function(){function ServerStream(e,t,n){this.protocol=e,this.repoMethod=t,this.server=n,this.def=t.definition}return Object.defineProperty(ServerStream.prototype,"name",{get:function(){return this.def.name},enumerable:!0,configurable:!0}),ServerStream.prototype.branches=function(e){var t=this,n=this.protocol.server.getBranchList(this.repoMethod);return e?n.indexOf(e)>-1?new o["default"](e,this.protocol,this.repoMethod):undefined:n.map(function(e){return new o["default"](e,t.protocol,t.repoMethod)})},ServerStream.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod).map(function(t){return new r["default"](e.protocol,e.repoMethod,t)})},Object.defineProperty(ServerStream.prototype,"definition",{get:function(){var e=this.def;return{accepts:e.accepts,description:e.description,displayName:e.displayName,name:e.name,objectTypes:e.objectTypes,returns:e.returns,supportsStreaming:e.supportsStreaming}},enumerable:!0,configurable:!0}),ServerStream.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod),this.server.unregister(this.repoMethod.definition)},ServerStream.prototype.push=function(e,t){if("string"!=typeof t&&!Array.isArray(t)&&t!==undefined)throw new Error("invalid branches should be string or string array");if("object"!=typeof e)throw new Error("Invalid arguments. Data must be an object.");this.protocol.server.pushData(this.repoMethod,e,t)},ServerStream}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(42),i=function(){function ServerStreaming(e,t){var n=this;this.protocol=e,this.server=t,e.server.onSubRequest(function(e,t){return n.handleSubRequest(e,t)}),e.server.onSubAdded(function(e,t){return n.handleSubAdded(e,t)}),e.server.onSubRemoved(function(e,t){return n.handleSubRemoved(e,t)})}return ServerStreaming.prototype.handleSubRequest=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRequestHandler){var n=new o["default"](this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}},ServerStreaming.prototype.handleSubAdded=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionAddedHandler){var n=new r["default"](this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}},ServerStreaming.prototype.handleSubRemoved=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRemovedHandler){var n=new r["default"](this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},ServerStreaming}();t["default"]=i},function(e,t,n){"use strict";function setupAGM(e,t){var n;"undefined"!=typeof window&&(window.htmlContainer?n=window.htmlContainer.windowId:window.glue42gd&&(n=window.glue42gd.windowId)),n&&(e.invoke("T42.Channels.Announce",{swId:n,instance:e.instance.instance}),e.register("T42.Channels.Command",function(e){var n=e.command;if(!n)throw new Error("missing command argument");if("join"===n){var r=e.channel;if(!r)throw new Error("missing argument id");return void t.join(r)}if("leave"===n)return void t.leave();if("get"===n){var r=t.current();return{id:r}}throw new Error("unknown command "+n)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.setupAGM=setupAGM},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),s=function(){function ChannelsImpl(e){this.shared=e,this.subsKey="subs",this.changedKey="changed",this.registry=i["default"](),this.shared.subscribe(this.handler.bind(this))}return ChannelsImpl.prototype.current=function(){return this.currentContext},ChannelsImpl.prototype.subscribe=function(e){return this.registry.add(this.subsKey,e)},ChannelsImpl.prototype.publish=function(e){if(!this.currentContext)throw new Error("not joined to any channel");return this.shared.update(this.currentContext,{data:e})},ChannelsImpl.prototype.join=function(e){return this.currentContext=e,this.registry.execute(this.changedKey,e),this.shared.switchChannel(e)},ChannelsImpl.prototype.leave=function(){return this.currentContext=undefined,this.registry.execute(this.changedKey,undefined),this.shared.unsubscribe()},ChannelsImpl.prototype.all=function(){return this.shared.all()},ChannelsImpl.prototype.changed=function(e){this.registry.add(this.changedKey,e)},ChannelsImpl.prototype.meta=function(e,t){throw new Error("Method not implemented.")},ChannelsImpl.prototype.add=function(e){return r(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:if(!e)throw new Error("info argument can not be undefined");if(!e.name)throw new Error("info.name is missing");return t={name:e.name,meta:e.meta||{},data:e.data||{}},[4,this.shared.add(e.name,t)];case 1:return n.sent(),[2,t]}})})},ChannelsImpl.prototype.remove=function(e){throw new Error("Method not implemented.")},ChannelsImpl.prototype.onChannelAdded=function(e){throw new Error("Method not implemented.")},ChannelsImpl.prototype.onChannelRemoved=function(e){throw new Error("Method not implemented.")},ChannelsImpl.prototype.apps=function(e){throw new Error("Method not implemented.")},ChannelsImpl.prototype.handler=function(e){this.registry.execute(this.subsKey,e.data,e)},ChannelsImpl}();t.ChannelsImpl=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function SharedContextSubscriber(e){this.contexts=e,this.unsubscribeFunc=undefined,this.current=undefined}return SharedContextSubscriber.prototype.subscribe=function(e){this.callback=e},SharedContextSubscriber.prototype.switchChannel=function(e){return r(this,void 0,void 0,function(){var t,n,r=this;return o(this,function(o){switch(o.label){case 0:return this.unsubscribe(),this.current=e,t=this.createContextName(e),n=this,[4,this.contexts.subscribe(t,function(e){r.callback&&r.callback(e)})];case 1:return n.unsubscribeFunc=o.sent(),[2]}})})},SharedContextSubscriber.prototype.unsubscribe=function(){return this.unsubscribeFunc&&this.unsubscribeFunc(),Promise.resolve()},SharedContextSubscriber.prototype.add=function(e,t){return r(this,void 0,void 0,function(){var n;return o(this,function(r){return n=this.createContextName(e),[2,this.contexts.set(n,t)]})})},SharedContextSubscriber.prototype.all=function(){var e=this.contexts.all(),t=e.filter(function(e){return e.startsWith("___channel___")}),n=t.map(function(e){return e.substr("___channel___".length)});return Promise.resolve(n)},SharedContextSubscriber.prototype.update=function(e,t){var n=this.createContextName(e);return this.contexts.update(n,t)},SharedContextSubscriber.prototype.createContextName=function(e){return"___channel___"+e},SharedContextSubscriber}();t.SharedContextSubscriber=i},function(e,t,n){"use strict";function factory(e,t){var n=new o.SharedContextSubscriber(e),s=new i.ChannelsImpl(n);return r.setupAGM(t,s),{subscribe:s.subscribe.bind(s),publish:s.publish.bind(s),all:s.all.bind(s),current:s.current.bind(s),join:s.join.bind(s),leave:s.leave.bind(s),add:s.add.bind(s),changed:s.changed.bind(s),ready:function(){return e.ready()}}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(46),o=n(48),i=n(47);t.factory=factory},function(e,t,n){"use strict";(function(e,r){function default_1(t,n,c,u,d){function getApplication(){return getConfigProp("application")}function getConfigProp(e,n){var r=f[e],o=t[e],i=p[e],s=h[e];if(n){if(r&&r[n]!==undefined)return r[n];if(o&&o[n]!==undefined)return o[n];if(i&&i[n]!==undefined)return i[n];if(s&&s[n]!==undefined)return s[n]}else{if(r!==undefined)return r;if(o!==undefined)return o;if(i!==undefined)return i;if(s!==undefined)return s}return undefined}function ifNotFalse(e,t){return"boolean"!=typeof e||e?t:undefined}"undefined"!=typeof window&&(e=e||window),e=e||{};var l=o.generate(),f=e.GLUE_CONFIG||{},p=e.GLUE_DEFAULT_CONFIG||{},h=function(){return{application:function(){return c?c.containerName+"."+c.browserWindowName:u?u.appName:"undefined"!=typeof window&&"undefined"!=typeof document?(window.agm_application||document.title)+l:"NodeJS"+l}(),metrics:function(){var e="undefined"!=typeof document?document.title:"unknown";if(e=e||"none",void 0===c)return{system:"Connect.Browser",service:t.application||e,instance:"~"+l};if("undefined"!=typeof c.metricsFacade.getIdentity){var n=c.metricsFacade.getIdentity();return{system:n.system,service:n.service,instance:n.instance}}return{system:"HtmlContainer."+c.containerName,service:"JS."+c.browserWindowName,instance:"~"+c.machineName}}(),agm:{},gateway:function(){var e=3,t="ws://localhost:8385";return u&&(e=3,t=u.gwURL),{ws:t,http:"http://localhost:8385",protocolVersion:e,reconnectInterval:1e3}}(),logger:function(){return{publish:"off",console:"info",metrics:"off"}}()}}(),m={system:getConfigProp("metrics","system"),service:getConfigProp("metrics","service"),instance:getConfigProp("metrics","instance")};return{identity:m,application:getApplication(),auth:function(){return getConfigProp("auth")}(),logger:function(){return getConfigProp("logger")}(),connection:function(){var e=getConfigProp("gateway","force");if(c===undefined||e){var t=getConfigProp("gateway"),n=getConfigProp("gateway","protocolVersion"),o=getConfigProp("gateway","reconnectInterval"),a=getConfigProp("gateway","reconnectAttempts"),l=t.ws,f=t.http,p=t.inproc;l||f||p||(i["default"].isNode()||"WebSocket"in window&&2===window.WebSocket.CLOSING?l=getConfigProp("gateway","ws"):f=getConfigProp("gateway","http"));var h=void 0,m=void 0;c?h=c.windowId:void 0!==u?(h=u.windowId,m=u.pid):i["default"].isNode()&&(m=r.pid);var g=getConfigProp("gateway","replaySpecs")||[];return g.push(s.ContextMessageReplaySpec),{identity:{application:getApplication(),windowId:h,process:m},reconnectInterval:o,ws:l,http:f,gw:p,protocolVersion:n,reconnectAttempts:a,force:!0,replaySpecs:g,gdVersion:d}}return{gdVersion:d}}(),metrics:function(){return ifNotFalse(getConfigProp("metrics"),{identity:m})}(),agm:function(){return ifNotFalse(t.agm,{instance:{application:getApplication()}})}(),contexts:!0,version:n.version||a.version,libs:n.libs}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=n(9),s=n(8),a=n(10);t["default"]=default_1}).call(t,n(5),n(17))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),i=n(53),s=function(e){function GW3ConnectionImpl(t){var n=e.call(this,t)||this;return t.replaySpecs&&t.replaySpecs.length&&(n.replayer=new i.MessageReplayerImpl(t.replaySpecs)),n}return r(GW3ConnectionImpl,e),GW3ConnectionImpl.prototype.init=function(t,n){e.prototype.init.call(this,t,n),this.replayer&&this.replayer.init(this),this.gw3Protocol=n},GW3ConnectionImpl.prototype.toAPI=function(){var t=this,n=e.prototype.toAPI.call(this);return{domain:t.domain.bind(t),get peerId(){return t.peerId},get token(){return t.token},get info(){return t.info},get resolvedIdentity(){return t.resolvedIdentity},get availableDomains(){return t.availableDomains},get gatewayToken(){return t.gatewayToken},get replayer(){return t.replayer},on:n.on,send:n.send,off:n.off,login:n.login,logout:n.logout,loggedIn:n.loggedIn,connected:n.connected,disconnected:n.disconnected,authToken:t.authToken.bind(t),get protocolVersion(){return n.protocolVersion}}},GW3ConnectionImpl.prototype.domain=function(e,t,n,r){return this.gw3Protocol.domain(e,t,n,r)},GW3ConnectionImpl.prototype.authToken=function(){return this.gw3Protocol.authToken()},GW3ConnectionImpl}(o["default"]);t["default"]=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),o=n(54),i=n(56),s=n(59),a=n(51),c=n(57),u=n(58);t["default"]=function(e){e=e||{},e.reconnectAttempts=e.reconnectAttempts||10,e.reconnectInterval=e.reconnectInterval||500;var t=new r["default"](e),n=e.logger;if(!n)throw new Error("please pass a logger object");var d=new i["default"],l=new c["default"];if(2!==e.gdVersion||e.force){if(e.gw&&e.gw.facade&&e.gw.token&&3===e.protocolVersion)l=new u["default"](e.gw.token,e.gw.facade,n.subLogger("inproc"));else{if(e.ws===undefined)throw new Error("No connection information specified");l=new s["default"](e,n.subLogger("ws"))}if(3===e.protocolVersion){var f=new a["default"](e),p=o["default"](f,e,n.subLogger("gw3"));return f.init(l,p),f.toAPI()}throw new Error("protocolVersion 3 or greater supported")}return t.init(l,d),t.toAPI()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function MessageReplayerImpl(e){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var t=0,n=e;t<n.length;t++){var r=n[t];this.specs[r.name]=r,this.specsNames.push(r.name)}}return MessageReplayerImpl.prototype.init=function(e){var t=this;this.connection=e;for(var n=0,r=this.specsNames;n<r.length;n++)for(var o=r[n],i=this,s=0,a=this.specs[o].types;s<a.length;s++){var c=a[s];!function(n){var r=i.subsRefCount[n];if(r||(r=0),r+=1,i.subsRefCount[n]=r,r>1)return"continue";var o=e.on("glue-core",n,function(e){return t.processMessage(n,e)});i.subs[n]=o}(c)}},MessageReplayerImpl.prototype.processMessage=function(e,t){if(!this.isDone&&t)for(var n=0,r=this.specsNames;n<r.length;n++){var o=r[n];if(-1!==this.specs[o].types.indexOf(e)){var i=this.messages[o]||[];this.messages[o]=i,i.push(t)}}},MessageReplayerImpl.prototype.drain=function(e,t){t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(var n=0,r=this.specs[e].types;n<r.length;n++){var o=r[n];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(this.connection.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[e],this.specs.length||(this.isDone=!0)},MessageReplayerImpl}();t.MessageReplayerImpl=r},function(e,t,n){"use strict";function default_1(e,t,n){function processStringMessage(e){var t=JSON.parse(e,function(e,t){if("string"!=typeof t)return t;if(t.length<d)return t;if(t[0]!==l)return t;if(t.substring(0,u)!==c)return t;try{var n=parseInt(t.substring(u,t.length),10);return isNaN(n)?t:new Date(n)}catch(e){return t}});return{msg:t,msgType:t.type}}function createStringMessage(e,t,n,r){var o=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return c+this.getTime()};return JSON.stringify(n)}finally{Date.prototype.toJSON=o}}function processObjectMessage(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}}function createObjectMessage(e,t,n,r){return n}function login(o){return n.debug("logging in..."),a=o,a||(a={username:"",password:""}),h=!0,new Promise(function(s,a){var c={};if(e.gatewayToken=o.gatewayToken,e.gatewayToken)c.method="gateway-token",c.token=e.gatewayToken;else if(o.token)c.method="access-token",c.token=o.token;else{if(!o.username)throw new Error("invalid auth message"+JSON.stringify(o));c.method="secret",c.login=o.username,c.secret=o.password}var u={type:"hello",identity:t.identity,authentication:c};i=r["default"]("global",e,n,["welcome","token"]);var d={skipPeerId:!0};m&&(d.retryInterval=t.reconnectInterval,d.maxRetries=t.reconnectAttempts),i.send(u,undefined,d).then(function(t){m=!1,n.debug("login successful with PeerId "+t.peer_id),e.peerId=t.peer_id,e.resolvedIdentity=t.resolved_identity,e.availableDomains=t.available_domains,t.options&&(e.token=t.options.access_token,e.info=t.options.info),setLoggedIn(!0),s(t.resolved_identity)})["catch"](function(e){n.error("error sending hello message - "+e),a(e)})})}function logout(){n.debug("logging out..."),h=!1,s&&clearTimeout(s),v.forEach(function(e){e.leave()})}function loggedIn(e){return p&&e(),f.add("onLoggedIn",e)}function domain(t,n,o,i){var s=v.filter(function(e){return e.domain===t})[0];return s||(s=r["default"](t,e,n,o,i),v.push(s)),s}function handleDisconnected(){if(setLoggedIn(!1),h&&m){if(g<=0)return;g--}n.debug("disconnected - will try new login?"+h),h&&e.login(a)["catch"](function(){setTimeout(handleDisconnected,1e3)})}function setLoggedIn(e){(p=e)&&f.execute("onLoggedIn")}function ping(){h&&(p&&e.send("","",{type:"ping"}),s=setTimeout(ping,3e4))}function authToken(){var e={type:"create-token"};return i.send(e).then(function(e){return e.token})}var i,s,a,c="#T42_DATE#",u=c.length,d=u+1,l=c[0],f=o["default"](),p=!1,h=!0,m=!0,g=3,v=[];return e.disconnected(handleDisconnected.bind(this)),ping(),{processStringMessage:processStringMessage,createStringMessage:createStringMessage,createObjectMessage:createObjectMessage,processObjectMessage:processObjectMessage,login:login,logout:logout,loggedIn:loggedIn,domain:domain,authToken:authToken}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(55),o=n(1);t["default"]=default_1},function(e,t,n){"use strict";function default_1(e,t,n,i,s){function join(t){return a=t,new Promise(function(r,o){if(c)return void r();var i;if("global"===e)i=d?Promise.resolve({}):Promise.reject("not connected to gateway");else{n.debug("joining "+e);i=send({type:"join",destination:e,domain:"global",options:t})}i.then(function(){handleJoined(),r()})["catch"](function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),o(t)})})}function leave(){if("global"!==e){n.debug("stopping session "+e+"...");send({type:"leave",destination:e,domain:"global"}).then(function(){c=!1,l.execute("onLeft")})}}function handleJoined(){n.debug("did join "+e),c=!0;var t=u;u=!1,l.execute("onJoined",t)}function handleConnectionDisconnected(){d=!1,n.warn("connection is down"),c=!1,u=!0,l.execute("onLeft",{disconnected:!0})}function handleConnectionLoggedIn(){d=!0,u&&(n.info("connection is now up - trying to reconnect..."),join(a))}function onJoined(e){return c&&e(!1),l.add("onJoined",e)}function onLeft(e){return c||e(),l.add("onLeft",e)}function handleErrorMessage(t){if(e===t.domain){var n=t.request_id,r=f[n];r&&r.error(t)}}function handleSuccessMessage(t){if(t.domain===e){var n=t.request_id,r=f[n];r&&r.success(t)}}function getNextRequestId(){return o.generate()}function send(r,o,i){i=i||{},r.request_id=r.request_id||getNextRequestId(),r.domain=r.domain||e,i.skipPeerId||(r.peer_id=t.peerId);var s=r.request_id;return new Promise(function(a,c){f[s]={success:function(e){delete f[s],e._tag=o,a(e)},error:function(e){n.warn("GW error - "+JSON.stringify(e)+" for request "+JSON.stringify(r)),delete f[s],e._tag=o,c(e)}},t.send(e,e,r,undefined,i)["catch"](function(e){f[s].error({err:e})})})}function sendFireAndForget(n){n.request_id=n.request_id?n.request_id:getNextRequestId(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(e,e,n)}null==e&&(e="global");var a,c=!1,u=!1,d=!1,l=r();t.disconnected(handleConnectionDisconnected),t.loggedIn(handleConnectionLoggedIn),t.on(e,"success",function(e){return handleSuccessMessage(e)}),t.on(e,"error",function(e){return handleErrorMessage(e)}),t.on(e,"result",function(e){return handleSuccessMessage(e)}),i&&i.forEach(function(n){t.on(e,n,function(e){return handleSuccessMessage(e)})}),s&&s.forEach(function(n){t.on(e,n,function(e){return handleErrorMessage(e)})});var f={};return{join:join,leave:leave,onJoined:onJoined,onLeft:onLeft,send:send,sendFireAndForget:sendFireAndForget,on:function(r,o){t.on(e,r,function(t){if(t.domain===e)try{o(t)}catch(e){n.error("Callback  failed: "+e+" \n msg was: "+JSON.stringify(t))}})},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId},get domain(){return e}}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(4);t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function HCProtocol(){}return HCProtocol.prototype.processStringMessage=function(e){var t=JSON.parse(e);return{msg:t,msgType:t.type}},HCProtocol.prototype.createStringMessage=function(e,t,n,r){return JSON.stringify(n)},HCProtocol.prototype.login=function(e){return Promise.resolve({application:undefined})},HCProtocol.prototype.logout=function(){},HCProtocol.prototype.loggedIn=function(e){return e(),function(){}},HCProtocol.prototype.processObjectMessage=function(e){throw new Error("not supported")},HCProtocol.prototype.createObjectMessage=function(e,t,n,r){throw new Error("not supported")},HCProtocol}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function HCTransport(){this.connectionId=Math.floor(1e10*Math.random()).toString()}return HCTransport.prototype.send=function(e,t,n){return"metrics"===t?window.htmlContainer.metricsFacade.send(n,e):"log"===t&&window.htmlContainer.loggingFacade.send(n,e),Promise.resolve(undefined)},HCTransport.prototype.onConnectedChanged=function(e){e(!0)},HCTransport.prototype.onMessage=function(e){},HCTransport.prototype.close=function(){},HCTransport.prototype.open=function(){},HCTransport}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function Inproc(e,t,n){this.registry=r["default"](),this.gw=t,this.gwToken=e,this.logger=n,this.connectToken=this.gw.connect(this.gwToken,this.messageHandler.bind(this))}return Object.defineProperty(Inproc.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),Inproc.prototype.sendObject=function(e){return this.logger.debug(JSON.stringify(e)),this.gw.send(this.connectToken,e),Promise.resolve(undefined)},Inproc.prototype.send=function(e,t,n){return Promise.reject("not supported")},Inproc.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},Inproc.prototype.onConnectedChanged=function(e){e(!0)},Inproc.prototype.close=function(){},Inproc.prototype.open=function(){},Inproc.prototype.messageHandler=function(e){"trace"===this.logger.consoleLevel()&&this.logger.debug(JSON.stringify(e)),this.registry.execute("onMessage",e)},Inproc}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(9),i=o["default"].isNode()?n(25):window.WebSocket,s=function(){function WS(e,t){this._running=!0,this._initied=!1,this._registry=r["default"](),this._settings=e,this._logger=t}return WS.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},WS.prototype.send=function(e,t,n,r){var o=this;return new Promise(function(t,n){r=r||{},o.waitForSocketConnection(function(){try{o._ws.send(e),t()}catch(e){n(e)}},n,r.maxRetries,r.retryInterval)})},WS.prototype.open=function(){this._running=!0},WS.prototype.close=function(){this._running=!1,this._ws.close()},WS.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},WS.prototype.initiateSocket=function(){var e=this;this._logger.debug("initiating _ws to "+this._settings.ws+"..."),this._ws=new i(this._settings.ws),this._ws.onerror=function(t){e.notifyStatusChanged(!1,t)},this._ws.onclose=function(){e._logger.debug("_ws closed"),e.notifyStatusChanged(!1)},this._ws.onopen=function(){e._logger.debug("_ws opened"),e.notifyStatusChanged(!0)},this._ws.onmessage=function(t){e._registry.execute("onMessage",t.data)}},WS.prototype.waitForSocketConnection=function(e,t,n,r){var o=this;if(e||(e=function(){}),t||(t=function(){}),r===undefined&&(r=this._settings.reconnectInterval),n!==undefined){if(0===n)return void t("wait for socket on "+this._settings.ws+" failed - no more retries left");this._logger.debug("will retry "+n+" more times (every "+r+" ms)")}if(!this._running)return void t("wait for socket on "+this._settings.ws+" failed - socket closed by user");if(!this._ws||this._ws.readyState>1)this.initiateSocket();else if(1===this._ws.readyState)return e();setTimeout(function(){var i=n===undefined?undefined:n-1;o.waitForSocketConnection(e,t,i,r)},r)},WS.prototype.notifyStatusChanged=function(e,t){this._registry.execute("onConnectedChanged",e,t)},WS}();t["default"]=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i};Object.defineProperty(t,"__esModule",{value:!0});var i=n(61),s=n(64),a=n(13),c=n(8),u=function(){function GW3Bridge(e){var t=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._contextNameToId={},this._contextIdToName={},this._connection=e.connection,this._logger=e.logger,this._gw3Session=this._connection.domain("global",this._logger,[a.GW_MESSAGE_CONTEXT_CREATED,a.GW_MESSAGE_SUBSCRIBED_CONTEXT,a.GW_MESSAGE_CONTEXT_DESTROYED,a.GW_MESSAGE_CONTEXT_UPDATED]),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),this._connection.replayer.drain(c.ContextMessageReplaySpec.name,function(e){var n=e.type;n&&(n===a.GW_MESSAGE_CONTEXT_CREATED||n===a.GW_MESSAGE_CONTEXT_ADDED||n===a.GW_MESSAGE_ACTIVITY_CREATED?t.handleContextCreatedMessage(e):n===a.GW_MESSAGE_SUBSCRIBED_CONTEXT||n===a.GW_MESSAGE_CONTEXT_UPDATED||n===a.GW_MESSAGE_JOINED_ACTIVITY?t.handleContextUpdatedMessage(e):n!==a.GW_MESSAGE_CONTEXT_DESTROYED&&n!==a.GW_MESSAGE_ACTIVITY_DESTROYED||t.handleContextDestroyedMessage(e))})}return GW3Bridge.prototype.dispose=function(){for(var e=0,t=this._gw3Subscriptions;e<t.length;e++){var n=t[e];this._connection.off(n)}this._gw3Subscriptions.length=0;for(var r in this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},GW3Bridge.prototype.createContext=function(e,t){var n=this;return this._gw3Session.send({type:a.GW_MESSAGE_CREATE_CONTEXT,domain:"global",name:e,data:t,lifetime:"retained"}).then(function(r){if(n._contextNameToId[e]=r.context_id,!n._contextIdToName[r.context_id]){n._contextIdToName[r.context_id]=e;var o=n._contextNameToData[e]||new i.GW3ContextData(r.context_id,e,!0,null);return o.isAnnounced=!0,o.name=e,o.contextId=r.context_id,n._contextNameToData[e]=o,o.context=r.data,o.sentExplicitSubscription=!0,o.context&&n.invokeUpdateCallbacks(o,o.context),n.update(e,t).then(function(){return r.context_id})}return r.context_id})},GW3Bridge.prototype.all=function(){var e=this;return Object.keys(this._contextNameToData).filter(function(t){return e._contextNameToData[t].isAnnounced})},GW3Bridge.prototype.update=function(e,t){var n=this,r=this._contextNameToData[e];if(!r||!r.isAnnounced)return this.createContext(e,t);var o=this.calculateContextDelta(r.context,t);return Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length?this._gw3Session.send({type:a.GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:r.contextId,delta:o}).then(function(){n.handleUpdated(r,o)}):Promise.resolve()},GW3Bridge.prototype.set=function(e,t){var n=this,r=this._contextNameToData[e];return r&&r.isAnnounced?this._gw3Session.send({type:a.GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:r.contextId,delta:{reset:t}}).then(function(){n.handleUpdated(r,{reset:t,added:{},removed:[],updated:{}})}):this.createContext(e,t)},GW3Bridge.prototype.get=function(e){var t=this,n=this._contextNameToData[e];return n&&n.isAnnounced?Promise.resolve(n.context):new Promise(function(n,i){return r(t,void 0,void 0,function(){var t=this;return o(this,function(r){return this.subscribe(e,function(e,r){t.unsubscribe(r),n(e)}),[2]})})})},GW3Bridge.prototype.subscribe=function(e,t){var n=this._nextCallbackSubscriptionNumber;this._nextCallbackSubscriptionNumber+=1;var r=this._contextNameToData[e];if(!r||!r.isAnnounced)return r=r||new i.GW3ContextData(undefined,e,!1,undefined),this._contextNameToData[e]=r,r.updateCallbacks[n]=t,Promise.resolve(n);var o=r.hasCallbacks();return r.updateCallbacks[n]=t,o?(t(r.context,n),Promise.resolve(n)):r.joinedActivity?(t(r.context,n),Promise.resolve(n)):r.context&&r.sentExplicitSubscription?(t(r.context,n),Promise.resolve(n)):this.sendSubscribe(r).then(function(){return n})},GW3Bridge.prototype.unsubscribe=function(e){for(var t=0,n=Object.keys(this._contextNameToData);t<n.length;t++){var r=n[t],o=(this._contextNameToId[r],this._contextNameToData[r]);if(!o)return;var i=o.hasCallbacks();delete o.updateCallbacks[e],o.isAnnounced&&i&&!o.hasCallbacks()&&o.sentExplicitSubscription&&this.sendUnsubscribe(o),o.isAnnounced||o.hasCallbacks()||delete this._contextNameToData[r]}},GW3Bridge.prototype.handleUpdated=function(e,t){var n=e.context;e.context=s.applyContextDelta(e.context,t),this._contextNameToData[e.name]!==e||s.deepEqual(n,e.context)||this.invokeUpdateCallbacks(e,e.context)},GW3Bridge.prototype.subscribeToContextCreatedMessages=function(){for(var e=[a.GW_MESSAGE_CONTEXT_ADDED,a.GW_MESSAGE_CONTEXT_CREATED,a.GW_MESSAGE_ACTIVITY_CREATED],t=0,n=e;t<n.length;t++){var r=n[t],o=this._connection.on("js-contexts",r,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(o)}},GW3Bridge.prototype.handleContextCreatedMessage=function(e){var t=e.type;t===a.GW_MESSAGE_ACTIVITY_CREATED?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):t===a.GW_MESSAGE_CONTEXT_ADDED?(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name):a.GW_MESSAGE_CONTEXT_CREATED;var n=this._contextIdToName[e.context_id];if(!n)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[n])throw new Error("Received created event for context with unknown id: "+e.context_id);var r=this._contextNameToData[n];if(r){if(r.isAnnounced)return;if(!r.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");r.isAnnounced=!0,r.contextId=e.context_id,r.activityId=e.activity_id,r.sentExplicitSubscription||this.sendSubscribe(r)}else this._contextNameToData[n]=r=new i.GW3ContextData(e.context_id,n,!0,e.activity_id)},GW3Bridge.prototype.subscribeToContextUpdatedMessages=function(){for(var e=[a.GW_MESSAGE_CONTEXT_UPDATED,a.GW_MESSAGE_SUBSCRIBED_CONTEXT,a.GW_MESSAGE_JOINED_ACTIVITY],t=0,n=e;t<n.length;t++){var r=n[t],o=this._connection.on("js-contexts",r,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(o)}},GW3Bridge.prototype.handleContextUpdatedMessage=function(e){var t=e.type,n=e.context_id,r=this._contextNameToData[this._contextIdToName[n]],o=!r||!r.isAnnounced;if(t===a.GW_MESSAGE_JOINED_ACTIVITY)r?(r.contextId=n,r.isAnnounced=!0,r.activityId=e.activity_id):(r=new i.GW3ContextData(n,e.activity_id,!0,e.activity_id),this._contextNameToData[e.activity_id]=r,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n),r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(t===a.GW_MESSAGE_SUBSCRIBED_CONTEXT?(r=r||new i.GW3ContextData(n,e.name,!0,null),r.sentExplicitSubscription=!0,this._contextNameToData[e.name]=r,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error("Received 'update' for unknown context: "+n));var c=r.context;if(t===a.GW_MESSAGE_SUBSCRIBED_CONTEXT)r.context=e.data||{};else if(t===a.GW_MESSAGE_JOINED_ACTIVITY)r.context=e.context_snapshot||{};else{if(t!==a.GW_MESSAGE_CONTEXT_UPDATED)throw new Error("Unrecognized context update message "+t);r.context=s.applyContextDelta(r.context,e.delta)}!o&&s.deepEqual(r.context,c)&&t!==a.GW_MESSAGE_SUBSCRIBED_CONTEXT||this.invokeUpdateCallbacks(r,r.context)},GW3Bridge.prototype.invokeUpdateCallbacks=function(e,t){for(var n in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(n))try{var r=e.updateCallbacks[n];r(s.deepClone(t),parseInt(n))}catch(e){this._logger.debug("Callback error: "+JSON.stringify(e))}},GW3Bridge.prototype.subscribeToContextDestroyedMessages=function(){for(var e=[a.GW_MESSAGE_CONTEXT_DESTROYED,a.GW_MESSAGE_ACTIVITY_DESTROYED],t=0,n=e;t<n.length;t++){var r=n[t],o=this._connection.on("js-contexts",r,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(o)}},GW3Bridge.prototype.handleContextDestroyedMessage=function(e){var t,n,r=e.type;if(r===a.GW_MESSAGE_ACTIVITY_DESTROYED){if(n=e.activity_id,!(t=this._contextNameToId[n]))return void this._logger.error("Received 'destroyed' for unknown activity: "+e.activity_id)}else if(t=e.context_id,!(n=this._contextIdToName[t]))return void this._logger.error("Received 'destroyed' for unknown context: "+e.context_id);delete this._contextIdToName[t],delete this._contextNameToId[n];var o=this._contextNameToData[n];if(delete this._contextNameToData[n],!o||!o.isAnnounced)return void this._logger.error("Received 'destroyed' for unknown context: "+t)},GW3Bridge.prototype.sendSubscribe=function(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:a.GW_MESSAGE_SUBSCRIBE_CONTEXT,domain:"global",context_id:e.contextId}).then(function(e){return undefined})},GW3Bridge.prototype.sendUnsubscribe=function(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:a.GW_MESSAGE_UNSUBSCRIBE_CONTEXT,domain:"global",context_id:e.contextId}).then(function(e){return undefined})},GW3Bridge.prototype.calculateContextDelta=function(e,t){var n={added:{},updated:{},removed:[],reset:null};if(e)for(var r=0,o=Object.keys(e);r<o.length;r++){var i=o[r];-1===Object.keys(t).indexOf(i)||null===t[i]||s.deepEqual(e[i],t[i])||(n.updated[i]=t[i])}for(var a=0,c=Object.keys(t);a<c.length;a++){var i=c[a];e&&-1!==Object.keys(e).indexOf(i)?null===t[i]&&n.removed.push(i):null!==t[i]&&(n.added[i]=t[i])}return n},GW3Bridge}();t.GW3Bridge=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function GW3ContextData(e,t,n,r){this.updateCallbacks={},this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=r,this.context={}}return GW3ContextData.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},GW3ContextData.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},GW3ContextData}();t.GW3ContextData=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function HCBridge(e){this._facade=window.htmlContainer.sharedContextFacade}return HCBridge.prototype.all=function(){var e=this._facade.all();return e&&e.keys?e.keys:[]},HCBridge.prototype.update=function(e,t){return this._facade.update(e,t),Promise.resolve()},HCBridge.prototype.set=function(e,t){return this._facade.set(e,t),Promise.resolve()},HCBridge.prototype.subscribe=function(e,t){var n=null,r=this._facade.subscribe(e,function(e){if(!r)return void(n=e);n&&(t(n,r),n=null),t(e,r)});return n&&(t(n,r),n=null),Promise.resolve(r)},HCBridge.prototype.get=function(e){var t=this;return new Promise(function(n,i){return r(t,void 0,void 0,function(){var t=this;return o(this,function(r){return this.subscribe(e,function(e,r){t.unsubscribe(r),n(e)}),[2]})})})},HCBridge.prototype.unsubscribe=function(e){this._facade.unsubscribe(e)},HCBridge}();t.HCBridge=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(60),o=n(62),i=function(){function ContextsModule(e){this.config=e;try{if(2===e.gdMajorVersion){if(!window.htmlContainer.sharedContextFacade)throw new Error("Your version of HtmlContainer does not support contexts. Get version 1.46.0.0 or later to have that feature.");this._bridge=new o.HCBridge(e)}else{if(3!==e.connection.protocolVersion)throw new Error("To use the Contexts library you must run in the HTML Container or using a connection to Gateway v3.");this._bridge=new r.GW3Bridge(e)}}catch(e){throw e}}return ContextsModule.prototype.all=function(){return this._bridge.all()},ContextsModule.prototype.update=function(e,t){return this.checkName(e),this._bridge.update(e,t)},ContextsModule.prototype.set=function(e,t){return this.checkName(e),this._bridge.set(e,t)},ContextsModule.prototype.subscribe=function(e,t){var n=this;return this.checkName(e),this._bridge.subscribe(e,function(e,r){return t(e,function(){return n._bridge.unsubscribe(r)})}).then(function(e){return function(){n._bridge.unsubscribe(e)}})},ContextsModule.prototype.get=function(e){return this._bridge.get(e)},ContextsModule.prototype.ready=function(){return Promise.resolve(this)},ContextsModule.prototype.checkName=function(e){if("string"!=typeof e||""==e)throw new Error("'name' must be non-empty string, got '"+e+"'")},ContextsModule}();t.ContextsModule=i},function(e,t,n){"use strict";function applyContextDelta(e,t){if(t){if(t.reset)return e=r({},t.reset);e=deepClone(e,null);var n=t.added,i=t.updated,s=t.removed;n&&Object.keys(n).forEach(function(t){e[t]=n[t]}),i&&Object.keys(i).forEach(function(t){o(t,e,i)}),s&&s.forEach(function(t){delete e[t]})}return e}function deepClone(e,t){if(t=t||new WeakMap,Object(e)!==e)return e;if(e instanceof Set)return new Set(e);if(t.has(e))return t.get(e);var n=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e.constructor?new e.constructor:Object.create(null);return t.set(e,n),e instanceof Map&&Array.from(e,function(e){var r=e[0],o=e[1];return n.set(r,deepClone(o,t))}),Object.assign.apply(Object,[n].concat(Object.keys(e).map(function(n){var r;return r={},r[n]=deepClone(e[n],t),r})))}function deepEqual(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!=typeof e[n])return!1;if(!deepEqual(e[n],t[n]))return!1}}for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.applyContextDelta=applyContextDelta,t.deepClone=deepClone;var o=function(e,t,n){var r=n[e];if(r===undefined)return t;var o=t[e];return o&&r?"string"==typeof o||"number"==typeof o||"boolean"==typeof o||"string"==typeof r||"number"==typeof r||"boolean"==typeof r||Array.isArray(o)||Array.isArray(r)?(t[e]=r,t):(t[e]=Object.assign({},o,r),t):(t[e]=r,t)};t.deepEqual=deepEqual},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(63);t.ContextsModule=r.ContextsModule},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function LogLevel(){}return LogLevel.canPublish=function(e,t){return LogLevel.order.indexOf(e)>=LogLevel.order.indexOf(t)},LogLevel.off="off",LogLevel.trace="trace",LogLevel.debug="debug",LogLevel.info="info",LogLevel.warn="warn",LogLevel.error="error",LogLevel.order=[LogLevel.trace,LogLevel.debug,LogLevel.info,LogLevel.warn,LogLevel.error,LogLevel.off],LogLevel}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(66),o=function(){function LoggerImpl(e,t,n){this._subloggers=[],this._name=e,this._parent=t,this._path=t?t.path+"."+e:e,this._loggerFullName="["+this._path+"]",void 0!==n&&this.metricsLevel("warn",n.subSystem(e))}return Object.defineProperty(LoggerImpl.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(LoggerImpl.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),LoggerImpl.prototype.subLogger=function(e){var t=this._subloggers.filter(function(t){return t.name===e})[0];if(t!==undefined)return t;Object.keys(this).forEach(function(t){if(t===e)throw new Error("This sub logger name is not allowed.")});var n=new LoggerImpl(e,this);return this._subloggers.push(n),n},LoggerImpl.prototype.publishLevel=function(e){return null!==e&&e!==undefined&&(this._publishLevel=e),this._publishLevel||this._parent.publishLevel()},LoggerImpl.prototype.consoleLevel=function(e){return null!==e&&e!==undefined&&(this._consoleLevel=e),this._consoleLevel||this._parent.consoleLevel()},LoggerImpl.prototype.metricsLevel=function(e,t){if(null!==e&&e!==undefined&&(this._metricLevel=e),t!==undefined){if("object"!=typeof t||"function"!=typeof t.objectMetric)throw new Error("Please specify metric system");this._metricSystem=t}return this._metricLevel||this._parent.metricsLevel()},LoggerImpl.prototype.log=function(e,t){this.publishMessage(t||r["default"].info,e)},LoggerImpl.prototype.trace=function(e){this.log(e,r["default"].trace)},LoggerImpl.prototype.debug=function(e){this.log(e,r["default"].debug)},LoggerImpl.prototype.info=function(e){this.log(e,r["default"].info)},LoggerImpl.prototype.warn=function(e){this.log(e,r["default"].warn)},LoggerImpl.prototype.error=function(e){this.log(e,r["default"].error)},LoggerImpl.prototype.toAPIObject=function(){var e=this;return{name:this.name,subLogger:this.subLogger.bind(e),publishLevel:this.publishLevel.bind(e),consoleLevel:this.consoleLevel.bind(e),metricsLevel:this.metricsLevel.bind(e),log:this.log.bind(e),trace:this.trace.bind(e),debug:this.debug.bind(e),info:this.info.bind(e),warn:this.warn.bind(e),error:this.error.bind(e)}},LoggerImpl.prototype.publishMessage=function(e,t){var n=this._loggerFullName;if(e===r["default"].error){var o=new Error;o.stack&&(t=t+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(r["default"].canPublish(e,this.consoleLevel())){var i=n+": "+t;switch(e){case r["default"].trace:console.trace(i);break;case r["default"].debug:console.debug?console.debug(i):console.log(i);break;case r["default"].info:console.info(i);break;case r["default"].warn:console.warn(i);break;case r["default"].error:console.error(i)}}r["default"].canPublish(e,this.publishLevel())&&LoggerImpl.GetConnection().send("log","LogMessage",{instance:LoggerImpl.Instance,level:r["default"].order.indexOf(e),logger:n,message:t}),r["default"].canPublish(e,this.metricsLevel())&&this._metricSystem!==undefined&&(this._metricSystem.objectMetric("LogMessage",{Level:e,Logger:n,Message:t,Time:new Date}),e===r["default"].error&&this._metricSystem.setState(100,t))},LoggerImpl}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(67);t["default"]=function(e){var t=e.identity;if(!t)throw new Error("identity is missing");var n=t.system+"\\"+t.service+"\\"+t.instance;r["default"].Instance=n,r["default"].GetConnection=e.getConnection;var o=new r["default"]("main");return o.publishLevel(e.publish||"off"),o.consoleLevel(e.console||"info"),o.metricsLevel(e.metrics||"off"),o.toAPIObject()}},function(e,t,n){"use strict";var r=n(15),o=n(10);"undefined"!=typeof window&&(window.GlueCore=r["default"]),r["default"]["default"]=r["default"],r["default"].version=o.version,e.exports=r["default"]},function(e,t,n){"use strict";function addressMetric(e,t,n,i){function update(e){a=e,s.updateMetric(y)}function getValueType(){return undefined}r["default"].validate(e,t,n);var s=n,a=i||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,l=e.period,f=e.resolution,p=t,h=t.repo,m=e.conflation,g=t.path+"/"+u,v=o["default"].ADDRESS,y={name:u,description:d,period:l,resolution:f,system:p,repo:h,id:g,type:v,conflation:m,get value(){return a},get path(){return c},update:update,getValueType:getValueType};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0);t["default"]=addressMetric},function(e,t,n){"use strict";function countMetric(e,t,n,i){function update(e){a=e,s.updateMetric(y)}function getValueType(){return undefined}function incrementBy(e){update(a+e)}function increment(){incrementBy(1)}function decrement(){incrementBy(-1)}function decrementBy(e){incrementBy(-1*e)}r["default"].validate(e,t,n);var s=n,a=i||0,c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,l=e.period,f=e.resolution,p=e.conflation,h=t,m=t.repo,g=t.path+"/"+u,v=o["default"].COUNT,y={name:u,description:d,period:l,resolution:f,system:h,repo:m,id:g,type:v,conflation:p,get path(){return c},get value(){return a},update:update,getValueType:getValueType,incrementBy:incrementBy,increment:increment,decrement:decrement,decrementBy:decrementBy};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0);t["default"]=countMetric},function(e,t,n){"use strict";function numberMetric(e,t,n,i){function update(e){c=e,s.updateMetric(y)}function getValueType(){return undefined}function incrementBy(e){update(c+e)}function increment(){incrementBy(1)}function decrement(){incrementBy(-1)}function decrementBy(e){incrementBy(-1*e)}r["default"].validate(e,t,n);var s=n,a=t.path.slice(0),c=i||0,u=e.name,d=e.description,l=e.period,f=e.resolution,p=e.conflation,h=t,m=t.repo,g=t.path+"/"+u,v=o["default"].NUMBER;a.push(t.name);var y={name:u,description:d,period:l,resolution:f,system:h,repo:m,id:g,conflation:p,get value(){return c},type:v,get path(){return a},update:update,getValueType:getValueType,incrementBy:incrementBy,increment:increment,decrement:decrement,decrementBy:decrementBy};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0);t["default"]=numberMetric},function(e,t,n){"use strict";function objectMetric(e,t,n,i){function update(e){mergeValues(e),s.updateMetric(y)}function getValueType(){return undefined}function mergeValues(e){return Object.keys(a).forEach(function(t){"undefined"!=typeof e[t]&&(a[t]=e[t])})}o["default"].validate(e,t,n);var s=n,a=i||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,l=e.period,f=e.resolution,p=e.conflation,h=t,m=t.repo,g=t.path+"/"+u,v=r["default"].OBJECT,y={name:u,description:d,period:l,resolution:f,system:h,repo:m,id:g,type:v,conflation:p,get value(){return a},get path(){return c},update:update,getValueType:getValueType};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(2);t["default"]=objectMetric},function(e,t,n){"use strict";function rateMetric(e,t,n,i){function update(e){a=e,s.updateMetric(y)}function getValueType(){return undefined}r["default"].validate(e,t,n);var s=n,a=i||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,l=e.period,f=e.resolution,p=e.conflation,h=t,m=t.repo,g=t.path+"/"+u,v=o["default"].RATE,y={name:u,description:d,period:l,resolution:f,system:h,repo:m,id:g,type:v,conflation:p,get value(){return a},get path(){return c},update:update,getValueType:getValueType};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0);t["default"]=rateMetric},function(e,t,n){"use strict";function statisticsMetric(e,t,n,i){function update(e){a=e,s.updateMetric(y)}function getValueType(){return undefined}r["default"].validate(e,t,n);var s=n,a=i||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,l=e.period,f=e.resolution,p=e.conflation,h=t,m=t.repo,g=t.path+"/"+u,v=o["default"].STATISTICS,y={name:u,description:d,period:l,resolution:f,system:h,repo:m,id:g,type:v,conflation:p,get value(){return a},get path(){return c},update:update,getValueType:getValueType};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0);t["default"]=statisticsMetric},function(e,t,n){"use strict";function stringMetric(e,t,n,i){function update(e){a=e,s.updateMetric(y)}function getValueType(){return undefined}r["default"].validate(e,t,n);var s=n,a=i||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,l=e.period,f=e.resolution,p=e.conflation,h=t,m=t.repo,g=t.path+"/"+u,v=o["default"].STRING,y={name:u,description:d,period:l,resolution:f,system:h,repo:m,id:g,conflation:p,get value(){return a},get path(){return c},type:v,update:update,getValueType:getValueType};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0);t["default"]=stringMetric},function(e,t,n){"use strict";function timespanMetric(e,t,n,i){function update(e){a=e,s.updateMetric(y)}function start(){update(!0)}function stop(){update(!1)}function getValueType(){return undefined}r["default"].validate(e,t,n);var s=n,a=i||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,l=e.period,f=e.resolution,p=e.conflation,h=t,m=t.repo,g=t.path+"/"+u,v=o["default"].TIMESPAN,y={name:u,description:d,period:l,resolution:f,system:h,repo:m,id:g,type:v,conflation:p,get value(){return a},get path(){return c},update:update,start:start,stop:stop,getValueType:getValueType};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0);t["default"]=timespanMetric},function(e,t,n){"use strict";function timestampMetric(e,t,n,i){function update(e){a=e,s.updateMetric(y)}function now(){update(new Date)}function getValueType(){return undefined}r["default"].validate(e,t,n);var s=n,a=i||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,l=e.period,f=e.resolution,p=e.conflation,h=t,m=t.repo,g=t.path+"/"+u,v=o["default"].TIMESTAMP,y={name:u,description:d,period:l,resolution:f,system:h,repo:m,id:g,type:v,conflation:p,get value(){return a},get path(){return c},update:update,now:now,getValueType:getValueType};return s.createMetric(y),y}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0);t["default"]=timestampMetric},function(e,t,n){"use strict";function default_1(e,t){function sendFull(e){e.root&&0!==e.root.subSystems.length&&sendFullSystem(e.root)}function sendFullSystem(e){createSystem(e),e.subSystems.forEach(function(e){sendFullSystem(e)}),e.metrics.forEach(function(e){createMetric(e)})}function heartbeat(e){i("HeartbeatMetrics",{publishingInterval:o,instance:e.instance})}function createSystem(e){e.parent!==undefined&&i("CreateMetricSystem",{id:e.id,instance:e.repo.instance,definition:{name:e.name,description:e.description,path:e.path}})}function updateSystem(e,t){i("UpdateMetricSystem",{id:e.id,instance:e.repo.instance,state:t})}function createMetric(e){i("CreateMetric",r["default"](e))}function updateMetric(e){i("UpdateMetric",r["default"](e))}function init(e){heartbeat(e),n.on("metrics","MetricsSnapshotRequest",function(t){t.Instance===e.instance&&sendFull(e)}),"undefined"!=typeof window&&"undefined"==typeof window.htmlContainer&&setInterval(function(){heartbeat(e)},o)}if(!e||"object"!=typeof e)throw new Error("Connection is required parameter");var n=e,o=t.heartbeatInterval||3e3,i=function(e,t){n.send("metrics",e,t)};return{createSystem:createSystem,updateSystem:updateSystem,createMetric:createMetric,updateMetric:updateMetric,init:init}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(80);t["default"]=default_1},function(e,t,n){"use strict";function metricToMessage(e){function getMetricDefinition(e,t,n,o,i,s,a,c){var u={name:e,description:i,type:o||getTypeFromValue(t),path:n,resolution:a,period:s,conflation:c};return u.type===r["default"].OBJECT&&(u.Composite=Object.keys(t).reduce(function(e,r){var o=t[r];return e.push(getMetricDefinition(r,o,n)),e},[])),u}function serializeValue(e,t){if(e&&e.constructor===Date)return{value:{type:n.indexOf("date"),value:e.valueOf(),isArray:!1}};if("object"==typeof e)return{CompositeValue:Object.keys(e).reduce(function(t,n){var r=serializeValue(e[n]);return r.InnerMetricName=n,t.push(r),t},[])};var r=t?t.getValueType():undefined;return r=r||n.indexOf(typeof e),{value:{type:r,value:e,isArray:!1}}}function getTypeFromValue(e){switch(e.constructor===Date?"timestamp":typeof e){case"string":return r["default"].STRING;case"number":return r["default"].NUMBER;case"timestamp":return r["default"].TIMESTAMP;case"object":return r["default"].OBJECT}return 0}var t=getMetricDefinition(e.name,e.value,e.path,e.type,e.description,e.period,e.resolution,e.conflation),n=["boolean","int","number","long","string","date","object"];return{id:e.id,instance:e.repo.instance,definition:t,value:serializeValue(e.value,e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t["default"]=metricToMessage},function(e,t,n){"use strict";function default_1(e,t){if(!e||"object"!=typeof e)throw new Error("Connection is required parameter");var n,o,i=function(r){var i;n=new Promise(function(e){i=e}),o=e.domain("metrics",t.logger),o.onJoined(function(e){e||(i(),i=undefined);var t={name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},n={type:"define",metrics:[t]};o.send(n),e&&s(r)}),o.join(t.identity)},s=function(e){a(e.root)},a=function(e){c(e),e.metrics.forEach(function(e){d(e)}),e.subSystems.forEach(function(e){a(e)})},c=function(e){e.parent!==undefined&&n.then(function(){var t={name:r.normalizeMetricName(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},n={type:"define",metrics:[t]};o.send(n)})},u=function(t,i){n.then(function(){var n={type:"publish",values:[{name:r.normalizeMetricName(t.path.join("/")+"/"+t.name+"/State"),value:{Description:i.description,Value:i.state},timestamp:Date.now()}]};o.send(n);var s=r.composeMsgForRootStateMetric(t),a={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:s.description,Value:s.value},timestamp:Date.now()}]};o.send(a)})},d=function(e){n.then(function(){var t=r.serializeMetric(e),n={type:"define",metrics:[t]};o.send(n),"undefined"!=typeof e.value&&l(e)})},l=function(e){n.then(function(){var t=r.getMetricValueByType(e),n={type:"publish",values:[{name:r.normalizeMetricName(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};o.send(n)})};return{init:i,createSystem:c,updateSystem:u,createMetric:d,updateMetric:l}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(82);t["default"]=default_1},function(e,t,n){"use strict";function getMetricTypeByValue(e){return e.value&&e.value.constructor===Date||e.type===r["default"].TIMESPAN||e.type===r["default"].TIMESTAMP?"timestamp":"number"==typeof e.value?"number":"string"==typeof e.value||e.type===r["default"].STRING||e.type===r["default"].RATE?"string":"object"==typeof e.value?"object":void 0}function getTypeByValue(e){return e.constructor===Date?"timestamp":"number"==typeof e?"number":"string"==typeof e?"string":"object"==typeof e?"object":"string"}function serializeMetric(e){var t={},n=getMetricTypeByValue(e);if("object"===n){var r=Object.keys(e.value).reduce(function(t,n){var r=getTypeByValue(e.value[n]);if("object"===r){var o=defineNestedComposite(e.value[n]);t[n]={type:"object",description:"",context:{},composite:o}}else t[n]={type:r,description:"",context:{}};return t},{});t.composite=r}return t.name=normalizeMetricName(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function defineNestedComposite(e){return Object.keys(e).reduce(function(t,n){var r=getTypeByValue(e[n]);return t[n]="object"===r?{type:"object",description:"",context:{},composite:defineNestedComposite(e[n])}:{type:r,description:"",context:{}},t},{})}function normalizeMetricName(e){return void 0!==e&&e.length>0&&"/"!==e[0]?"/"+e:e}function getMetricValueByType(e){return"timestamp"===getMetricTypeByValue(e)?Date.now():publishNestedComposite(e.value)}function publishNestedComposite(e){return"object"!=typeof e?e:Object.keys(e).reduce(function(t,n){var r=e[n];return"object"==typeof r&&r.constructor!==Date?t[n]=publishNestedComposite(r):r.constructor===Date?t[n]=new Date(r).getTime():r.constructor===Boolean?t[n]=r.toString():t[n]=r,t},{})}function flatten(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?flatten(t):t)},[])}function getHighestState(e){return e.sort(function(e,t){return t.state-e.state})[0]}function aggregateDescription(e){var t="";return e.forEach(function(e,n,r){var o=e.path.join(".");n===r.length-1?t+=o+"."+e.name+": "+e.description:t+=o+"."+e.name+": "+e.description+","}),t.length>100?t.slice(0,100)+"...":t}function composeMsgForRootStateMetric(e){var t=e.root.getAggregateState(),n=flatten(t),r=getHighestState(n);return{description:aggregateDescription(n),value:r.state}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.serializeMetric=serializeMetric,t.normalizeMetricName=normalizeMetricName,t.getMetricValueByType=getMetricValueByType,t.composeMsgForRootStateMetric=composeMsgForRootStateMetric},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(81),o=n(79),i=n(84);t["default"]=function(e){var t={connection:e.connection,identity:e.identity,logger:e.logger,heartbeatInterval:e.heartbeatInterval,settings:{},clickStream:e.clickStream};if(!t.connection||"object"!=typeof t.connection)throw new Error("Connection is required parameter");var n;return n=3===t.connection.protocolVersion?r["default"](t.connection,e):o["default"](t.connection,e),i["default"](t,n).root}},function(e,t,n){"use strict";function repository(e,t){if(!e.identity)throw new Error("Identity missing from metrics configuration");if(!e.identity.service||"string"!=typeof e.identity.service)throw new Error("Service missing or invalid in metrics identity configuration");if(!e.identity.system||"string"!=typeof e.identity.system)throw new Error("System missing or invalid in metrics identity configuration");if(!e.identity.instance||"string"!=typeof e.identity.instance)throw new Error("Instance missing or invalid in metrics identity configuration");var n=e.identity,o=e.identity.system+"/"+e.identity.service+"/"+e.identity.instance,i={identity:n,instance:o,get root(){return s}};t.init(i);var s=r["default"]("",i,t);return function(e,t){if("undefined"!=typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!=typeof document){var n=e.subSystem("ClickStream"),r=function(e){if(e.target){var t=e.target;n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:e.target?t.className:"",id:t.id,type:"<"+t.tagName.toLowerCase()+">",href:t.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}var o=(e.stringMetric("StartTime",(new Date).toString()),e.stringMetric("StartURL","")),i=e.stringMetric("AppName","");if("undefined"!=typeof window){if("undefined"!=typeof window.location){var s=window.location.href;o.update(s)}"undefined"!=typeof window.glue42gd&&i.update(window.glue42gd.appName)}}(s,e.clickStream||e.clickStream===undefined),i}Object.defineProperty(t,"__esModule",{value:!0});var r=n(85);t["default"]=repository},function(e,t,n){"use strict";function system(e,t,n,p,h){function subSystem(e,t){if(!e||0===e.length)throw new Error("name is required");var n=T.filter(function(t){return t.name===e});if(n.length>0)return n[0];var r=system(e,y,m,k,t);return T.push(r),r}function setState(e,t){S={state:e,description:t},m.updateSystem(k,S)}function stringMetric(e,t){return _getOrCreateMetric.call(k,e,f["default"].STRING,t,function(e){return u["default"](e,k,m,t)})}function numberMetric(e,t){return _getOrCreateMetric.call(k,e,f["default"].NUMBER,t,function(e){return i["default"](e,k,m,t)})}function countMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].COUNT,t,function(e){return o["default"](e,k,m,t)})}function addressMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].ADDRESS,t,function(e){return r["default"](e,k,m,t)})}function objectMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].OBJECT,t,function(e){return s["default"](e,k,m,t)})}function timespanMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].TIMESPAN,t,function(e){return d["default"](e,k,m,t)})}function timestampMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].TIMESTAMP,t,function(e){return l["default"](e,k,m,t)})}function rateMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].RATE,t,function(e){return a["default"](e,k,m,t)})}function statisticsMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].STATISTICS,t,function(e){return c["default"](e,k,m,t)})}function _unionToMetricDef(e){var t={};if("string"==typeof e?t.name=e:t=e,t.name===undefined)throw new Error("Metric name is required");return t}function _getOrCreateMetric(e,t,n,r){var o=_unionToMetricDef(e),i=C.filter(function(e){return e.name===o.name});if(i.length>0){var s=i[0];if(s.type!==t)throw new Error("A metric named "+o.name+" is already defined with different type.");return void 0!==n&&s.update(n),s}var a=r(o);return C.push(a),a}function _buildPath(e){if(!e||!e.parent)return[];var t=_buildPath(e.parent);return t.push(e.name),t}function getAggregateState(){var e=[];return Object.keys(S).length>0&&e.push({name:g,path:_,state:S.state,description:S.description}),T.forEach(function(t){var n=t.getAggregateState();n.length>0&&e.push.apply(e,n)}),e}if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var m=n,g=e,v=h||"",y=t,b=p,_=_buildPath(p),S={},w=function(e,t){return e&&e.length>0?e.join(t):""}(_,"/")+e,M=t.identity,I=t.root,T=[],C=[],k={get name(){return g},get description(){return v},get repo(){return y},get parent(){return b},path:_,id:w,identity:M,root:I,get subSystems(){return T},get metrics(){return C},subSystem:subSystem,getState:function(){return S},setState:setState,stringMetric:stringMetric,statisticsMetric:statisticsMetric,rateMetric:rateMetric,timestampMetric:timestampMetric,timespanMetric:timespanMetric,objectMetric:objectMetric,addressMetric:addressMetric,countMetric:countMetric,numberMetric:numberMetric,getAggregateState:getAggregateState};return m.createSystem(k),k}Object.defineProperty(t,"__esModule",{value:!0});var r=n(70),o=n(71),i=n(72),s=n(73),a=n(74),c=n(75),u=n(76),d=n(77),l=n(78),f=n(0);t["default"]=system},function(e,t,n){"use strict";function default_1(){function now(){return(new Date).getTime()}function stop(){return e=now(),t=now()-n}var e,t,n=now();return{get startTime(){return n},get endTime(){return e},get period(){return t},stop:stop}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=default_1}])})},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){function getLibConfig(e,t,n){if("boolean"==typeof e&&!e)return undefined;var r=getModeAsString(e,t,n);return"object"==typeof e?(e.mode=r,e):{mode:r}}function getModeAsString(e,t,n){return"object"==typeof e?getModeAsString(e.mode,t,n)+"":void 0===e?"boolean"!=typeof t||t?t+"":undefined:"boolean"==typeof e?e?(n===undefined?t:n)+"":undefined:e+""}return{outlook:getLibConfig(e.outlook,!0),excel:getLibConfig(e.excel,!0),word:getLibConfig(e.word,!0)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShowGridMethodName="T42.ExcelPad.ShowGrid",t.ValidateShowGridMethodName="ValidateShowGrid"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(33),i=n(36),s=n(10),a=function(){function ExcelImp(e){var t=this;this._registry=r["default"](),this._sheets={},this._isExcelStarted=!1,this.openSheet=function(e){return new Promise(function(n,r){if(!e)return void r("Can not open a sheet without config");if(!e.columnConfig||!Array.isArray(e.columnConfig))return void r("Missing or incorrect type `columnConfig` property");if(!e.data||!Array.isArray(e.data))return void r("Missing or incorrect type of `data` property");var o=s.convertParams(e.columnConfig,e.data,e.options),a=function(r){if(s.parseAgmResult(r)){var a=new i["default"](o.params.cookie,e,t.invokeShowGridMethod.bind(t));t._sheets[o.params.cookie]=a,n(a.asSheetAPI)}},c=function(e){r(e)};return t.invokeShowGridMethod(o.params,o.agmOptions).then(a)["catch"](c)})},this.onAddinStatusChanged=function(e){return t._registry.add("onAddinStatusChanged",e)},this._agm=e,this.registerAgmMethod()}return Object.defineProperty(ExcelImp.prototype,"all",{get:function(){var e=this;return Object.keys(this._sheets).map(function(t){return e._sheets[t].asSheetAPI})},enumerable:!0,configurable:!0}),Object.defineProperty(ExcelImp.prototype,"addinStatus",{get:function(){return this._isExcelStarted},enumerable:!0,configurable:!0}),ExcelImp.prototype.registerAgmMethod=function(){var e=this;this._agm.register({name:o.ValidateShowGridMethodName,accepts:"string cookie, string workbook, string worksheet, string updateType, string dataAsJSON"},function(t,n){if(t.cookie){var r=e._sheets[t.cookie];if(r)return r._onUpdate(t)}return undefined}),this._agm.methodAdded(function(t){t.name===o.ShowGridMethodName&&(e._isExcelStarted=!0,e._registry.execute("onAddinStatusChanged",!0))}),this._agm.methodRemoved(function(t){t.name===o.ShowGridMethodName&&(e._isExcelStarted=!1,e._registry.execute("onAddinStatusChanged",!1))})},ExcelImp.prototype.invokeShowGridMethod=function(e,t){var n=this;return new Promise(function(r,i){n._isExcelStarted?n._agm.invoke(o.ShowGridMethodName,e,null,t).then(function(e){r(e)})["catch"](function(e){i(e)}):i("Microsoft Excel with Tick42 Add-in is not running")})},ExcelImp}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34);t["default"]=function(e){function ready(){return new Promise(function(e,t){e(n)})}var t=new r["default"](e.agm),n={ready:ready,openSheet:t.openSheet,get sheets(){return t.all},onAddinStatusChanged:t.onAddinStatusChanged,get addinStatus(){return t.addinStatus}};return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(10),i=function(){function SheetImpl(e,t,n){var o=this;this._registry=r["default"]({errorHandling:"throw"}),this.errorCallback=function(e){o._validationResponse={isValid:!1,errorsAsJSON:JSON.stringify(e)}},this.doneCallback=function(){o._validationResponse={isValid:!0}},this._id=e,this._name=t.options?t.options.worksheet:"",this._data=t.data,this._workbook=t.options?t.options.workbook:"",this._columns=t.columnConfig,this._options=t.options,this._invokeMethod=n}return Object.defineProperty(SheetImpl.prototype,"asSheetAPI",{get:function(){var e=this,t=this;return this._sheet||(this._sheet={name:this._name,workbook:this._workbook,options:this._options,get data(){return t._data},get columnConfig(){return t._columns},update:function(t){return e.update(t)},onChanged:function(t){return e.onChanged(t)},changeColumnConfig:function(t,n){return e.changeColumnConfig(t,n)}}),this._sheet},enumerable:!0,configurable:!0}),SheetImpl.prototype.changeColumnConfig=function(e,t){var n=this;return new Promise(function(r,i){if(!e)return void i("Can not change column in the sheet without columnConfig");t||(t=n._data);var s=o.convertParams(e,t,n._options,n._id),a=function(){n._data=t,r()};n._invokeMethod(s.params,s.agmOptions).then(a)["catch"](i)})},SheetImpl.prototype.update=function(e){var t=this;return new Promise(function(n,r){if(!e||!Array.isArray(e))return void r("Can not update sheet with empty or incorrect type `data`");var i=o.convertParams(t._columns,e,t._options,t._id);t._invokeMethod(i.params,i.agmOptions).then(function(){t._data=e,n()})["catch"](r)})},SheetImpl.prototype.onChanged=function(e){return this._registry.add("on-changed",e)},SheetImpl.prototype._onUpdate=function(e){this._name=e.worksheet,this._workbook=e.workbook;var t;try{t=JSON.parse(e.dataAsJSON)}catch(e){return void console.error(e)}return this.mergeData(e,t),this._registry.execute("on-changed",this._data,this.errorCallback,this.doneCallback,"row"===e.updateType?t:null),this._validationResponse},SheetImpl.prototype.mergeData=function(e,t){var n=this,r=[],o="row"===e.updateType;o&&(r=this._data);for(var i="deleted"===t[0].action?t.length-1:0,s="deleted"===t[0].action?-1:t.length,a="deleted"===t[0].action?-1:1,c=this,u=i;u!==s;u+=a)!function(e){var i=t[e],s=i.rowBeforeIndex-1,a=i.rowAfterIndex-1;if("unchanged"===i.action)r[a]=c._data[s];else if("deleted"===i.action)o&&r.splice(s,i.count||1);else if("modified"===i.action)i.row.forEach(function(e,t){if(null!==e){var o=n._columns[t].fieldName,i=n._data[s];i[o]=e,r[s]=i}});else if("inserted"===i.action){var u={};i.row.forEach(function(e,t){var r=n._columns[t].fieldName;u[r]=e||undefined}),r.splice(s,0,u)}}(u);this._data=r},SheetImpl}();t["default"]=i},function(e,t,n){"use strict";var r=n(19);"undefined"!=typeof window&&(window.Glue4Office=r["default"]),r["default"]["default"]=r["default"],e.exports=r["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function ChunkDataDictionary(){this.items={}}return ChunkDataDictionary.prototype.containsKey=function(e){return this.items.hasOwnProperty(e)},ChunkDataDictionary.prototype.add=function(e,t){this.containsKey(e)?this.items[e].push(t):this.items[e]=[t]},ChunkDataDictionary.prototype.remove=function(e){delete this.items[e]},ChunkDataDictionary.prototype.get=function(e){return this.items[e]},ChunkDataDictionary}();t.ChunkDataDictionary=r,t["default"]=new r},function(e,t,n){"use strict";function default_1(e){var t;if(!e.agm)throw Error("config.agm is required");var n=r["default"](),f=e.agm;o["default"].init(f),c.registerAgmMethods(f,n),l.registerEventListeners(f,n);var p=function(e){return l.registerOnAddinStatusChanged(f,e,n)},h=function(e){return l.registerOnEmailReceived(f,e,n)},m=function(e){return l.registerOnTaskCreated(f,e,n)},g=function(e){return l.registerTrackEmail(f,e,n)},v=function(e){return l.registerUntrackEmail(f,e,n)},y=function(e){return l.registerTrackItem(f,e,n)},b=function(e){return l.registerUntrackItem(f,e,n)},_=function(e){return l.registerSecureReply(f,e,n)},S=function(e){return l.registerDisplaySecureEmail(f,e,n)};return t={ready:function(){return new Promise(function(e){e(t)})},newEmail:function(e,t){return void 0===e&&(e={}),i.createEmail(f,e,t)},trackCalendarEvent:function(e,t){return u.handleTrackingItems(f,"track",e,t)},untrackCalendarEvent:function(e){return u.handleTrackingItems(f,"untrack",e)},createLocalEmail:function(e){return s.createLocalEmailMethod(f,e)},newTask:function(e,t){return void 0===e&&(e={}),a.createTask(f,e,t)},emailFromJSON:function(e){return d.itemFromJSON(e,f,"email")},taskFromJSON:function(e){return d.itemFromJSON(e,f,"task")},attachmentFromJSON:function(e){return d.itemFromJSON(e,f,"attachment")},showEmail:function(e){return o["default"].showItemMethod(e,"showEmail")},showTask:function(e){return o["default"].showItemMethod(e,"showTask")},onAddinStatusChanged:p,onEmailReceived:h,onTaskCreated:m,onTrackEmail:g,onUntrackEmail:v,onTrackCalendarEvent:y,onUntrackCalendarEvent:b,onSecureReply:_,onDisplaySecureEmail:S,get addinStatus(){return l.connected}}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(7),i=n(40),s=n(41),a=n(42),c=n(18),u=n(44),d=n(45),l=n(46);t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(16);t.createEmail=function(e,t,n){return new Promise(function(i,s){return r.isOutlookEnabled(e)?o.createItem(e,t,"email",n).then(function(){return i()})["catch"](s):void s('The method "newEmail" is not available')})}},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(6),s=n(1),a=n(3),c=function(e,t){var n=r({},o.convertToT42Email(t),{ids:e});return Object.keys(n).forEach(function(e){n[e]||delete n[e]}),n};t.createLocalEmailMethod=function(e,t){return new Promise(function(n,r){a.validateLocalEmailParameters(e,t);var o=function(t,r){var o=new i.EmailImpl(c(t.returned.localEmailIds,r),e);n(o)},u=function(e){r(e.message)};return t.location&&a.validateLocation(t.location),e.invoke(s.CreateLocalEmailMethodName,l(t)).then(function(e){return o(e,t)})["catch"](function(e){return u(e)})})};var u=function(e){return Object.keys(e).reduce(function(t,n){return"additionalProps"===n?t:(t[n]=e[n],t)},{})},d=function(e){var t=o.getOlDefaultFolders();if(!e)return{defaultFolderIndex:t.$Inbox};var n=e.ids;if(n&&n[0].nativeId&&n[0].systemName)return{parentItemIds:n};if("string"==typeof e){if(e.indexOf("$")<0)return{folderPath:e};if("number"==typeof t[e])return{defaultFolderIndex:t[e]}}return{defaultFolderIndex:t.$Inbox}},l=function(e){var t={location:d(e.location),email:o.convertToT42Email(u(e))};return e.additionalProps&&(t.additionalProps=e.additionalProps),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(16);t.createTask=function(e,t,n){return new Promise(function(i,s){if(!r.isOutlookEnabled(e))return void s('The method "newTask" is not available');o.createItem(e,t,"task",n).then(function(){return i()})["catch"](s)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(1),i=n(12);t.getAttachment=function(e,t,n,s){return new Promise(function(a,c){if(!r.isOutlookEnabled(e))return void c('The method "getAttachments" is not available');var u=(new Date).getTime().toString(),d=function(){i["default"].add(u,{callback:s,resolve:a,reject:c})},l=function(e){c(e.message)},f={emailIds:t,attachmentIds:n,callback:o.OutlookGetAttachmentMethodName,cookie:u};return e.invoke(o.CRMGetAttachmentMethodName,f).then(function(){return d()})["catch"](function(e){return l(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(1),i=n(3),s=n(15),a=function(e,t,n){var o=s["default"].containsIds(e.ids)?s["default"].get(e.ids):[];if(n){var i=t||r.generateConversationId();o.push(i),s["default"].containsIds(e.ids)||s["default"].add(e.ids,o)}return o};t.handleTrackingItems=function(e,t,n,r){return new Promise(function(c,u){i.validateCalendarEventParameters(e,t,n);var d=r?i.validateId(r):null,l="track"===t,f=a(n,d,l),p=function(){if(c({event:n,conversationIds:f}),!l){s["default"].remove(n.ids);var e=n.ids.filter(function(e){return"Outlook.ConversationId"===e.systemName});s["default"].add(n.ids,e)}},h=function(e){u(e.message)},m=l?o.SyncTrackCalendarItemMethodName:o.SyncUntrackCalendarItemMethodName,g={itemIds:n.ids,conversationIds:f};return e.invoke(m,g).then(function(e){return p()})["catch"](function(e){return h(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),o=n(6),i=n(5);t.itemFromJSON=function(e,t,n){if(!e)throw new Error(n+" is mandatory");if(!e.ids)throw new Error(n+" ids property is mandatory");return"email"===n?new o.EmailImpl(e,t):"task"===n?new r.TaskImpl(e,t):new i.AttachmentImpl(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(18),i=n(1);t.connected=!1;var s=function(e,n){r.isOutlookEnabled(e)&&(t.connected=!0),e.methodAdded(function(e){e.name===i.CreateItemMethodName&&!1===t.connected&&(t.connected=!0,n.execute("onAddinStatusChanged",{connected:t.connected}))})},a=function(e,n){e.methodRemoved(function(e){e.name===i.CreateItemMethodName&&(t.connected=!1,n.execute("onAddinStatusChanged",{connected:t.connected}))})};t.registerEventListeners=function(e,t){s(e,t),a(e,t)},t.registerOnAddinStatusChanged=function(e,n,r){return n({connected:t.connected}),r.add("onAddinStatusChanged",n)},t.registerOnEmailReceived=function(e,t,n){return n.add("onEmailReceived",t)},t.registerOnTaskCreated=function(e,t,n){return n.add("onTaskCreated",t)};var c=function(e,t,n){e(),t.methods({name:n}).length>0&&t.unregister(n)};t.registerTrackEmail=function(e,t,n){if(0===e.methods({name:i.OnTrackEmailMethodName}).length){o.registerCRMTrackEmail(e,n);var r=n.add("onEmailTracked",t);return function(){return c(r,e,i.OnTrackEmailMethodName)}}throw Error("Another client has already subscribed for tracking emails")},t.registerUntrackEmail=function(e,t,n){if(0===e.methods({name:i.OnUntrackEmailMethodName}).length){o.registerCRMUntrackEmail(e,n);var r=n.add("onEmailUntracked",t);return function(){return c(r,e,i.OnUntrackEmailMethodName)}}throw Error("Another client has already subscribed for untracking emails")},t.registerTrackItem=function(e,t,n){if(0===e.methods({name:i.OnTrackItemMethodName}).length){o.registerCRMTrackItem(e,n);var r=n.add("onItemTracked",t);return function(){return c(r,e,i.OnTrackItemMethodName)}}throw Error("Another client has already subscribed for tracking calendar events")},t.registerUntrackItem=function(e,t,n){if(0===e.methods({name:i.OnUntrackItemMethodName}).length){o.registerCRMUntrackItem(e,n);var r=n.add("onItemUntracked",t);return function(){return c(r,e,i.OnUntrackItemMethodName)}}throw Error("Another client has already subscribed for untracking calendar events")},t.registerSecureReply=function(e,t,n){return n.add("onSecureReply",t)},t.registerDisplaySecureEmail=function(e,t,n){return n.add("onDisplaySecureEmail",t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.low=0]="low",e[e.normal=1]="normal",e[e.high=2]="high"}(t.TaskPriority||(t.TaskPriority={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),o=n(2);t["default"]=function(e,t,n){function onClose(e){return s.add("on-closed",e)}function _close(){s.execute("on-closed")}function getHtml(t){return new Promise(function(t,o){n.invoke(r.ReturnHtmlMethodName,{cookie:e,callbackMethod:r.OnReturnHtmlMethodName}),i=t})}function onChanged(e){return s.add("on-changed",e)}function _combineChunks(e,t){if(e.length===e.totalLength&&e.lengthDocx===e.totalLengthDocx)u=e.html,d=e.docx,t(u,d);else{0===e.offset&&(u=""),0===e.offsetDocx&&(d=""),e.html&&e.html.length>0&&(u=u.substr(0,e.offset)+e.html+u.substr(e.offset+e.length)),e.docx&&e.docx.length>0&&(d=d.substr(0,e.offsetDocx)+e.docx+d.substr(e.offsetDocx+e.lengthDocx));var n=e.totalLengthDocx||0;e.totalLength!==u.length||0!==n&&n!==d.length||t(u,d)}}function _onHtml(e){_combineChunks(e,function(e,t){i(e)})}function _onChanged(e){_combineChunks(e,function(e,t){l.data=e,s.execute("on-changed",l.data,t)})}var i,s=o(),a=t.name,c=t.data,u="",d="",l={name:a,data:c,getHtml:getHtml,onClose:onClose,onChanged:onChanged};return{documentApi:l,documentEvents:{_onChanged:_onChanged,_close:_close,_onHtml:_onHtml}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=n(8),i=n(48),s=n(50),a=n(2);t["default"]=function(e){function openDocument(e){return new r.Promise(function(n,r){function sendChunks(t){var n=p.splice(0,1);if(0===n.length)return void c(t);a.sendDocx=!0,e.isDocx?(a.docx=n[0],a.lengthDocx=n[0].length,a.totalLengthDocx=e.data.length,a.offsetDocx=f*o.ChunkSize):(a.html=n[0],a.length=n[0].length,a.totalLength=e.data.length,a.offset=f*o.ChunkSize),invokeEditHtmlMethod(a).then(sendChunks)["catch"](d),f++}for(var a=s.mapOptions(e),c=function(r){a.cookie=r.returned.sessionId;var o=i["default"](a.cookie,e,t);u[a.cookie]=o,n(o.documentApi)},d=function(e){console.warn(e),r(e)},l=0,f=0,p=[];l<e.data.length;)p.push(e.data.substr(l,o.ChunkSize)),l+=o.ChunkSize;sendChunks()})}function invokeEditHtmlMethod(e){return new r.Promise(function(n,r){c?t.invoke(o.EditHtmlMethodName,e).then(n)["catch"](r):r("Microsoft Word with Tick42 Add-in is not running")})}function ready(){return new r.Promise(function(e,t){e(d)})}function onAddinStatusChanged(e){return t.methods({name:o.EditHtmlMethodName}).length>0&&(c=!0),e({connected:c}),n.add("onStatusChanged",e)}var t=e.agm,n=a(),c=!1,u={};t.methodAdded(function(e){e.name===o.EditHtmlMethodName&&!1===c&&(c=!0,n.execute("onStatusChanged",{connected:c}))}),t.methodRemoved(function(e){e.name===o.EditHtmlMethodName&&(c=!1,n.execute("onStatusChanged",{connected:c}))}),t.register(o.ReceiveHtmlMethodName,function(e,t){var n=u[e.cookie];return n&&n.documentEvents._onChanged(e),undefined}),t.register(o.OnReturnHtmlMethodName,function(e,t){var n=u[e.cookie];return n&&n.documentEvents._onHtml(e),undefined}),t.register({name:o.CloseMethodName,accepts:"String documentName, String cookie"},function(e,t){var n=u[e.cookie];return n&&n.documentEvents._close(),delete u[e.cookie],undefined});var d={get all(){return Object.keys(u).map(function(e){return u[e].documentApi})},openDocument:openDocument,ready:ready,onAddinStatusChanged:onAddinStatusChanged,get addinStatus(){return c}};return d}},function(e,t,n){"use strict";function mapOptions(e){return{displayName:"",documentName:e.name,templateName:e.templateName,onSaved:r.ReceiveHtmlMethodName,onClosed:r.CloseMethodName}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(8);t.mapOptions=mapOptions},function(e,t){}])});
//# sourceMappingURL=glue4office.min.js.map